<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Alts Fund Link ‚Äî Platform</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root {
  --navy:#0B1F3B;--navy2:#1C3A63;--navy3:#2A4D7A;--slate:#3A5270;--slate2:#5C7A99;
  --fog:#8FA3BA;--mist:#C8D8E8;--ice:#E8F0F8;--white:#FFFFFF;--surface:#F4F7FB;--surface2:#EEF3FA;
  --green:#1A7A4A;--green-lt:#E8F7EF;--amber:#B45309;--amber-lt:#FEF3C7;
  --red:#991B1B;--red-lt:#FEE2E2;--blue:#1D4ED8;--blue-lt:#EFF6FF;
  --comp-accent:#7C3AED;--comp-lt:#F5F3FF;--report-accent:#0D7490;--report-lt:#ECFEFF;
  --radius:8px;--radius-lg:14px;--radius-xl:20px;
  --shadow-sm:0 1px 3px rgba(11,31,59,0.08),0 1px 2px rgba(11,31,59,0.06);
  --shadow:0 4px 12px rgba(11,31,59,0.10),0 2px 4px rgba(11,31,59,0.06);
  --shadow-lg:0 12px 32px rgba(11,31,59,0.14),0 4px 8px rgba(11,31,59,0.08);
  --shadow-xl:0 24px 64px rgba(11,31,59,0.18);
  --font:'DM Sans',sans-serif;--mono:'DM Mono',monospace;
  --header-h:60px;--nav-w:220px;--transition:0.18s cubic-bezier(0.4,0,0.2,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:var(--font);font-size:14px;line-height:1.5;background:var(--surface);color:var(--navy);-webkit-font-smoothing:antialiased}
a{color:inherit;text-decoration:none}button{cursor:pointer;font-family:var(--font)}input,select,textarea{font-family:var(--font)}
#app{display:flex;flex-direction:column;height:100vh;overflow:hidden}
#header{height:var(--header-h);background:var(--navy);display:flex;align-items:center;padding:0 20px;gap:16px;flex-shrink:0;position:relative;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,0.25)}
#logo{display:flex;align-items:center;gap:10px;flex-shrink:0}
#logo-mark{width:32px;height:32px;background:linear-gradient(135deg,#3B82F6,#1D4ED8);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;color:#fff;letter-spacing:-0.5px}
#logo-text{font-size:14px;font-weight:600;color:#fff;letter-spacing:0.02em;line-height:1.2}
#logo-sub{font-size:10px;color:var(--fog);font-weight:400;letter-spacing:0.08em;text-transform:uppercase}
#view-toggle{display:flex;align-items:center;background:rgba(255,255,255,0.08);border-radius:8px;padding:3px;gap:2px;margin-left:12px}
.view-btn{display:flex;align-items:center;gap:6px;padding:5px 12px;border-radius:6px;border:none;background:transparent;color:var(--fog);font-size:12.5px;font-weight:500;letter-spacing:0.01em;transition:all var(--transition);white-space:nowrap}
.view-btn:hover{color:var(--white);background:rgba(255,255,255,0.10)}
.view-btn.active{background:var(--white);color:var(--navy);font-weight:600}
.view-btn.active.compliance{background:#DDD6FE;color:#4C1D95}
.view-btn.active.client-report{background:#CFFAFE;color:#164E63}
.view-dot{width:6px;height:6px;border-radius:50%;background:currentColor;opacity:0.5}
.view-btn.active .view-dot{opacity:1}
#client-badge{margin-left:auto;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);border-radius:8px;padding:5px 12px;cursor:pointer;transition:background var(--transition);flex-shrink:0}
#client-badge:hover{background:rgba(255,255,255,0.14)}
#client-badge-icon{width:24px;height:24px;border-radius:50%;background:linear-gradient(135deg,var(--navy3),var(--blue));display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff}
#client-badge-text{font-size:12px;color:var(--white);font-weight:500}
#client-badge-text small{display:block;font-size:10px;color:var(--fog);font-weight:400}
#data-status{font-size:11px;color:var(--fog);display:flex;align-items:center;gap:6px;flex-shrink:0}
.pulse-dot{width:6px;height:6px;border-radius:50%;background:#34D399;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.4;transform:scale(0.8)}}
.pulse-dot.loading{background:#F59E0B;animation:spin-dot 0.8s linear infinite}
.pulse-dot.error{background:#F87171;animation:none}
@keyframes spin-dot{0%{transform:scale(0.6);opacity:0.5}50%{transform:scale(1);opacity:1}100%{transform:scale(0.6);opacity:0.5}}
#body-area{display:flex;flex:1;overflow:hidden}
#sidebar{width:var(--nav-w);background:var(--white);border-right:1px solid var(--mist);display:flex;flex-direction:column;overflow-y:auto;flex-shrink:0;transition:background var(--transition)}
#sidebar.compliance-mode{background:#FDFBFF;border-right-color:#DDD6FE}
#sidebar.report-mode{background:#FDFFFE;border-right-color:#A5F3FC}
.nav-section{padding:8px 0;border-bottom:1px solid var(--surface2)}
.nav-section:last-child{border-bottom:none;flex:1}
.nav-label{font-size:10px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--fog);padding:8px 16px 4px}
.nav-item{display:flex;align-items:center;gap:9px;padding:8px 16px;font-size:13px;font-weight:500;color:var(--slate);cursor:pointer;border-radius:0;border:none;background:transparent;width:100%;text-align:left;transition:all var(--transition);position:relative}
.nav-item:hover{background:var(--surface);color:var(--navy)}
.nav-item.active{background:var(--ice);color:var(--navy);font-weight:600}
.nav-item.active::before{content:'';position:absolute;left:0;top:4px;bottom:4px;width:3px;background:var(--navy2);border-radius:0 2px 2px 0}
#sidebar.compliance-mode .nav-item.active{background:var(--comp-lt);color:#4C1D95}
#sidebar.compliance-mode .nav-item.active::before{background:var(--comp-accent)}
#sidebar.report-mode .nav-item.active{background:var(--report-lt);color:var(--report-accent)}
#sidebar.report-mode .nav-item.active::before{background:var(--report-accent)}
.nav-icon{font-size:14px;width:18px;text-align:center;flex-shrink:0}
.nav-badge{margin-left:auto;min-width:18px;height:18px;background:var(--navy2);color:#fff;border-radius:9px;font-size:10px;font-weight:700;display:inline-flex;align-items:center;justify-content:center;padding:0 5px}
#main{flex:1;overflow-y:auto;padding:28px 32px}
.page-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:24px;gap:16px}
.page-title{font-size:22px;font-weight:700;color:var(--navy);letter-spacing:-0.02em;line-height:1.2}
.page-subtitle{font-size:13px;color:var(--slate2);margin-top:3px}
.panel{background:var(--white);border:1px solid var(--mist);border-radius:var(--radius-lg);padding:20px 24px;box-shadow:var(--shadow-sm)}
.panel-title{font-size:13px;font-weight:700;letter-spacing:0.04em;text-transform:uppercase;color:var(--slate);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:var(--radius);border:none;font-size:13px;font-weight:600;cursor:pointer;transition:all var(--transition);white-space:nowrap}
.btn-primary{background:var(--navy);color:var(--white)}.btn-primary:hover{background:var(--navy2)}
.btn-secondary{background:var(--white);color:var(--navy);border:1.5px solid var(--mist)}.btn-secondary:hover{border-color:var(--slate2);background:var(--surface)}
.btn-ghost{background:transparent;color:var(--slate2);border:1.5px solid transparent}.btn-ghost:hover{color:var(--navy);background:var(--surface)}
.btn-sm{padding:5px 10px;font-size:12px}
.btn-icon{padding:7px;border-radius:var(--radius);background:var(--surface);border:1px solid var(--mist);color:var(--slate);display:inline-flex;align-items:center;justify-content:center;font-size:14px;cursor:pointer;transition:all var(--transition)}
.btn-icon:hover{background:var(--ice);color:var(--navy);border-color:var(--slate2)}
.btn-icon.active{background:var(--navy);color:var(--white);border-color:var(--navy)}
.badge{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:20px;font-size:11px;font-weight:600;letter-spacing:0.02em}
.badge-green{background:var(--green-lt);color:var(--green)}.badge-amber{background:var(--amber-lt);color:var(--amber)}
.badge-red{background:var(--red-lt);color:var(--red)}.badge-blue{background:var(--blue-lt);color:var(--blue)}
.badge-navy{background:var(--ice);color:var(--navy2)}.badge-purple{background:#EDE9FE;color:#5B21B6}
.suit-score{display:inline-flex;align-items:center;gap:4px;font-size:11px;font-weight:700;padding:3px 8px;border-radius:20px}
.suit-score.high{background:var(--green-lt);color:var(--green)}.suit-score.medium{background:var(--amber-lt);color:var(--amber)}.suit-score.low{background:var(--red-lt);color:var(--red)}
.metric-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
.metric-tile{background:var(--surface);border:1px solid var(--mist);border-radius:var(--radius);padding:14px 16px}
.metric-label{font-size:11px;font-weight:600;color:var(--fog);text-transform:uppercase;letter-spacing:0.07em;margin-bottom:4px}
.metric-value{font-size:22px;font-weight:700;color:var(--navy);letter-spacing:-0.02em;line-height:1}
.metric-sub{font-size:11px;color:var(--slate2);margin-top:3px}
.pill{display:inline-flex;align-items:center;padding:3px 8px;border-radius:20px;font-size:11.5px;font-weight:500;background:var(--surface2);color:var(--slate);border:1px solid var(--mist)}
.divider{height:1px;background:var(--mist);margin:16px 0}
.empty-state{text-align:center;padding:48px 24px;color:var(--slate2)}
.empty-state-icon{font-size:40px;margin-bottom:12px}
.empty-state h3{font-size:16px;font-weight:600;color:var(--navy);margin-bottom:6px}
.empty-state p{font-size:13px;line-height:1.6;max-width:360px;margin:0 auto 20px}
.offering-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:16px}
.offering-card{background:var(--white);border:1.5px solid var(--mist);border-radius:var(--radius-lg);padding:18px;cursor:pointer;transition:all var(--transition);position:relative;overflow:hidden}
.offering-card:hover{border-color:var(--slate2);box-shadow:var(--shadow);transform:translateY(-1px)}
.offering-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;gap:8px}
.offering-name{font-size:14px;font-weight:700;color:var(--navy);line-height:1.3;flex:1}
.offering-sponsor{font-size:11.5px;color:var(--slate2);margin-top:2px}
.offering-badges{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:12px}
.offering-metrics{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.offering-metric-item{background:var(--surface);border-radius:var(--radius);padding:8px 10px}
.offering-metric-item .label{font-size:10px;font-weight:600;color:var(--fog);text-transform:uppercase;letter-spacing:0.07em}
.offering-metric-item .value{font-size:16px;font-weight:700;color:var(--navy);letter-spacing:-0.02em}
.offering-location{font-size:12px;color:var(--slate2);display:flex;align-items:center;gap:4px;margin-bottom:10px}
.offering-card-footer{display:flex;justify-content:space-between;align-items:center;padding-top:10px;border-top:1px solid var(--surface2)}
.raise-bar{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden;margin-top:3px}
.raise-fill{height:100%;background:linear-gradient(90deg,var(--navy2),#3B82F6);border-radius:4px;animation:barFillIn 1.2s cubic-bezier(0.4,0,0.2,1) forwards}
.timeline-bar{height:8px;background:var(--surface2);border-radius:4px;overflow:hidden;margin-top:3px}
.timeline-fill{height:100%;background:linear-gradient(90deg,#059669,#34D399);border-radius:4px;animation:barFillIn 1.2s cubic-bezier(0.4,0,0.2,1) 0.3s forwards}
@keyframes barFillIn{from{max-width:0}to{max-width:100%}}
.peer-delta{font-size:10px;font-weight:600;margin-top:2px}.peer-delta.up{color:var(--green)}.peer-delta.down{color:var(--red)}.peer-delta.neutral{color:var(--fog)}
.card-status-strip{position:absolute;top:0;left:0;right:0;height:5px}
.card-status-strip.open{background:var(--green)}.card-status-strip.closing{background:var(--amber)}.card-status-strip.coming{background:var(--blue)}
.offering-table{width:100%;border-collapse:collapse;font-size:13px}
.offering-table thead th{background:var(--surface2);padding:9px 12px;text-align:left;font-size:11px;font-weight:700;color:var(--slate2);text-transform:uppercase;letter-spacing:0.07em;border-bottom:1px solid var(--mist);white-space:nowrap;cursor:pointer;user-select:none;position:sticky;top:0;z-index:10}
.offering-table thead th:hover{color:var(--navy);background:var(--ice)}
.offering-table thead th.sorted{color:var(--navy)}.offering-table thead th.sorted .sort-arrow{opacity:1}
.sort-arrow{margin-left:4px;opacity:0.3;font-size:10px}
.offering-table tbody tr{border-bottom:1px solid var(--surface2);cursor:pointer;transition:background var(--transition)}
.offering-table tbody tr:hover{background:var(--surface)}.offering-table tbody tr:last-child{border-bottom:none}
.offering-table td{padding:10px 12px;vertical-align:middle}
.offering-table td.name-cell{font-weight:600;color:var(--navy)}
.offering-table td.num-cell{font-weight:600;font-family:var(--mono);font-size:12.5px}
.offering-table td.num-cell.highlight-green{color:var(--green)}.offering-table td.num-cell.highlight-red{color:var(--red)}
.table-wrapper{border:1px solid var(--mist);border-radius:var(--radius-lg);overflow:hidden;background:var(--white)}
.filter-bar{display:flex;align-items:center;gap:8px;margin-bottom:12px;flex-wrap:wrap}
.filter-row-2{display:flex;align-items:center;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.filter-tag{display:flex;align-items:center;gap:5px;padding:5px 12px;border:1.5px solid var(--mist);border-radius:20px;font-size:12.5px;font-weight:500;color:var(--slate);cursor:pointer;background:var(--white);transition:all var(--transition);user-select:none}
.filter-tag:hover{border-color:var(--slate2);color:var(--navy)}.filter-tag.active{border-color:var(--navy);background:var(--navy);color:var(--white)}
.filter-select{height:34px;padding:0 28px 0 10px;border:1.5px solid var(--mist);border-radius:20px;font-size:12.5px;color:var(--slate);background:var(--white);cursor:pointer;outline:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%235C7A99' d='M5 7L1 2h8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;transition:border-color var(--transition)}
.filter-select:focus{border-color:var(--navy2)}
.search-input{flex:1;max-width:260px;height:34px;padding:0 12px 0 34px;border:1.5px solid var(--mist);border-radius:20px;font-size:13px;color:var(--navy);background:var(--white);outline:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%235C7A99' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:11px center;transition:border-color var(--transition)}
.search-input:focus{border-color:var(--navy2)}.search-input::placeholder{color:var(--fog)}
.view-toggle-group{display:flex;border:1.5px solid var(--mist);border-radius:8px;overflow:hidden}
.view-toggle-btn{padding:5px 10px;border:none;background:var(--white);color:var(--slate2);font-size:13px;cursor:pointer;transition:all var(--transition)}
.view-toggle-btn:hover{background:var(--surface);color:var(--navy)}.view-toggle-btn.active{background:var(--navy);color:var(--white)}
.sort-select{height:34px;padding:0 28px 0 10px;border:1.5px solid var(--mist);border-radius:8px;font-size:12.5px;color:var(--slate);background:var(--white);cursor:pointer;outline:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%235C7A99' d='M5 7L1 2h8z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;transition:border-color var(--transition)}
.sort-select:focus{border-color:var(--navy2)}
.result-bar{display:flex;align-items:center;gap:10px;margin-bottom:16px;font-size:12.5px;color:var(--slate2)}
.result-count{font-weight:700;color:var(--navy)}
.active-filter-chips{display:flex;gap:5px;flex-wrap:wrap}
.filter-chip{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;background:var(--ice);color:var(--navy2);border-radius:20px;font-size:11px;font-weight:600;border:1px solid var(--mist)}
.filter-chip button{background:none;border:none;color:var(--slate2);font-size:11px;padding:0;line-height:1;cursor:pointer;display:flex;align-items:center}
.filter-chip button:hover{color:var(--red)}
.range-filter{display:flex;align-items:center;gap:6px;height:34px;padding:0 12px;border:1.5px solid var(--mist);border-radius:20px;background:var(--white);font-size:12.5px;color:var(--slate)}
.range-filter input{width:44px;border:none;outline:none;font-size:12.5px;color:var(--navy);font-family:var(--mono);background:transparent;text-align:center;padding:0}
.range-filter span{color:var(--fog);font-size:11px}
.equity-filter{display:flex;align-items:center;gap:5px;height:34px;padding:0 12px;border:1.5px solid var(--mist);border-radius:20px;background:var(--white);font-size:12.5px;color:var(--slate);cursor:pointer;transition:all var(--transition);user-select:none}
.equity-filter.active{border-color:var(--navy);background:var(--ice);color:var(--navy)}.equity-filter:hover{border-color:var(--slate2)}
.modal-overlay{position:fixed;inset:0;background:rgba(11,31,59,0.55);backdrop-filter:blur(4px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.2s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:var(--white);border-radius:var(--radius-xl);width:100%;max-width:620px;max-height:88vh;overflow-y:auto;box-shadow:var(--shadow-xl);animation:slideUp 0.22s cubic-bezier(0.34,1.56,0.64,1)}
@keyframes slideUp{from{transform:translateY(24px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-header{padding:24px 28px 18px;border-bottom:1px solid var(--mist);display:flex;justify-content:space-between;align-items:flex-start}
.modal-title{font-size:18px;font-weight:700;color:var(--navy);letter-spacing:-0.02em}
.modal-subtitle{font-size:13px;color:var(--slate2);margin-top:3px}
.modal-close{width:30px;height:30px;border-radius:50%;background:var(--surface);border:none;font-size:16px;color:var(--slate);cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:-2px;transition:all var(--transition)}
.modal-close:hover{background:var(--ice);color:var(--navy)}
.modal-body{padding:24px 28px}.modal-footer{padding:16px 28px 24px;display:flex;justify-content:flex-end;gap:10px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}.form-grid-full{grid-column:1/-1}
.form-group{display:flex;flex-direction:column;gap:5px}
.form-label{font-size:12px;font-weight:600;color:var(--slate);letter-spacing:0.02em}.form-label span{color:var(--fog);font-weight:400}
.form-input{height:38px;padding:0 12px;border:1.5px solid var(--mist);border-radius:var(--radius);font-size:13.5px;color:var(--navy);background:var(--white);transition:border-color var(--transition);outline:none;width:100%}
.form-input:focus{border-color:var(--navy2);box-shadow:0 0 0 3px rgba(28,58,99,0.08)}.form-input::placeholder{color:var(--fog)}
.form-select{height:38px;padding:0 32px 0 12px;border:1.5px solid var(--mist);border-radius:var(--radius);font-size:13.5px;color:var(--navy);background:var(--white);cursor:pointer;outline:none;width:100%;transition:border-color var(--transition);-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%235C7A99' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
.form-select:focus{border-color:var(--navy2);box-shadow:0 0 0 3px rgba(28,58,99,0.08)}
.checkbox-group{display:flex;flex-wrap:wrap;gap:8px}
.checkbox-pill{display:flex;align-items:center;gap:6px;padding:6px 12px;border:1.5px solid var(--mist);border-radius:20px;cursor:pointer;font-size:12.5px;font-weight:500;color:var(--slate);transition:all var(--transition);background:var(--white);user-select:none}
.checkbox-pill:hover{border-color:var(--slate2);color:var(--navy);background:var(--surface)}
.checkbox-pill input{width:0;height:0;opacity:0;position:absolute}
.checkbox-pill.checked{border-color:var(--navy2);background:var(--ice);color:var(--navy);font-weight:600}
.form-section-label{font-size:11px;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--fog);margin-bottom:10px;margin-top:4px;padding-bottom:6px;border-bottom:1px solid var(--mist)}
.dashboard-grid{display:grid;grid-template-columns:340px 1fr;gap:20px;align-items:start}
.profile-card{background:var(--white);border:1.5px solid var(--mist);border-radius:var(--radius-lg);overflow:hidden}
.profile-card-header{background:linear-gradient(135deg,var(--navy) 0%,var(--navy2) 100%);padding:20px 22px;position:relative;overflow:hidden}
.profile-card-header::after{content:'';position:absolute;right:-30px;top:-30px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,0.04)}
.profile-card-header h3{font-size:13px;font-weight:700;color:rgba(255,255,255,0.5);letter-spacing:0.06em;text-transform:uppercase;margin-bottom:6px}
.profile-card-name{font-size:20px;font-weight:700;color:var(--white);letter-spacing:-0.02em}
.profile-card-firm{font-size:12.5px;color:rgba(255,255,255,0.55);margin-top:2px}
.profile-card-body{padding:18px 22px}
.profile-row{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid var(--surface2)}.profile-row:last-child{border-bottom:none}
.profile-key{font-size:12px;color:var(--slate2);font-weight:500}.profile-val{font-size:13px;color:var(--navy);font-weight:600;text-align:right}
.profile-card-footer{padding:12px 22px 18px;display:flex;gap:8px}
.suggested-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.suggested-title{font-size:15px;font-weight:700;color:var(--navy)}.suggested-sub{font-size:12px;color:var(--slate2);margin-top:1px}
.quick-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--white);border:1px solid var(--mist);border-radius:var(--radius);padding:14px 16px;text-align:center}
.stat-val{font-size:26px;font-weight:800;color:var(--navy);letter-spacing:-0.03em;line-height:1}
.stat-label{font-size:11px;color:var(--slate2);font-weight:500;margin-top:4px;text-transform:uppercase;letter-spacing:0.06em}
.start-here-card{background:linear-gradient(135deg,#EFF6FF 0%,#E0F2FE 100%);border:1.5px dashed #93C5FD;border-radius:var(--radius-lg);padding:28px 24px;text-align:center}
.start-here-icon{font-size:36px;margin-bottom:12px}.start-here-title{font-size:16px;font-weight:700;color:var(--navy);margin-bottom:6px}
.start-here-text{font-size:13px;color:var(--slate);line-height:1.6;margin-bottom:18px}
/* STEP 5: Detail-specific */
.detail-section{margin-bottom:16px}
.detail-two-col{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.detail-chart-wrap{position:relative;height:260px}
.detail-nav-strip{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;gap:8px}
.detail-nav-strip .breadcrumb{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--fog);flex:1;min-width:0}
.detail-nav-strip .breadcrumb .crumb-name{color:var(--slate);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:240px}
.detail-prev-next{display:flex;gap:4px;flex-shrink:0}
.detail-prev-next button{padding:5px 10px;border-radius:6px;border:1.5px solid var(--mist);background:var(--white);color:var(--slate);font-size:12px;font-weight:600;cursor:pointer;transition:all var(--transition);display:flex;align-items:center;gap:4px;max-width:160px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.detail-prev-next button:hover:not(:disabled){border-color:var(--navy2);color:var(--navy);background:var(--ice)}
.detail-prev-next button:disabled{opacity:0.35;cursor:default}
.kd-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.kd-item{display:flex;align-items:flex-start;gap:8px;padding:10px 12px;border-radius:var(--radius);background:var(--surface);border:1px solid var(--mist);font-size:12.5px;line-height:1.5;color:var(--navy)}
.kd-icon{font-size:14px;flex-shrink:0;margin-top:1px}
.kd-item.positive{background:var(--green-lt);border-color:#BBF7D0}
.kd-item.caution{background:var(--amber-lt);border-color:#FDE68A}
.kd-item.risk{background:var(--red-lt);border-color:#FECACA}
.kd-item.info{background:var(--blue-lt);border-color:#BFDBFE}
.val-callout{display:flex;align-items:center;gap:14px;padding:14px 18px;border-radius:var(--radius);font-size:13px;font-weight:600}
.val-callout.discount{background:var(--green-lt);border:1px solid #BBF7D0;color:var(--green)}
.val-callout.premium{background:var(--amber-lt);border:1px solid #FDE68A;color:var(--amber)}
.val-callout .val-pct{font-size:24px;font-weight:800;letter-spacing:-0.03em}
.proj-table{width:100%;border-collapse:collapse;font-size:12.5px}
.proj-table th{background:var(--surface2);padding:8px 10px;text-align:center;font-size:10px;font-weight:700;color:var(--slate2);text-transform:uppercase;letter-spacing:0.06em;border-bottom:1px solid var(--mist)}
.proj-table th:first-child{text-align:left}
.proj-table td{padding:8px 10px;text-align:center;border-bottom:1px solid var(--surface2);font-family:var(--mono);font-weight:500;color:var(--navy)}
.proj-table td:first-child{text-align:left;font-family:var(--font);font-weight:600;color:var(--slate);font-size:12px}
.proj-table tr:last-child td{border-bottom:none}.proj-table .highlight{background:var(--ice);font-weight:700}
.doc-btn-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px;padding:12px 16px;background:var(--surface);border-radius:var(--radius);border:1px solid var(--mist);align-items:center}
.doc-btn-row .doc-label{font-size:11px;font-weight:700;color:var(--fog);text-transform:uppercase;letter-spacing:0.06em;margin-right:4px;white-space:nowrap}
.action-bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px;padding-bottom:20px;border-bottom:1px solid var(--mist)}
.skeleton{background:linear-gradient(90deg,var(--surface2) 25%,var(--mist) 50%,var(--surface2) 75%);background-size:200% 100%;animation:shimmer 1.4s ease-in-out infinite;border-radius:4px}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.skeleton-card{background:var(--white);border:1px solid var(--mist);border-radius:var(--radius-lg);padding:18px;height:200px}
#main.compliance-mode .page-title{color:#4C1D95}#main.compliance-mode .panel{border-color:#DDD6FE}
.fade-in{animation:fadeIn 0.3s ease}.slide-in{animation:slideIn 0.25s cubic-bezier(0.4,0,0.2,1)}
@keyframes slideIn{from{transform:translateX(-12px);opacity:0}to{transform:translateX(0);opacity:1}}
.card-enter{animation:cardEnter 0.3s cubic-bezier(0.34,1.2,0.64,1) both}
@keyframes cardEnter{from{transform:translateY(12px) scale(0.97);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
#toast-container{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:8px}
.toast{background:var(--navy);color:var(--white);padding:11px 18px;border-radius:10px;font-size:13px;font-weight:500;box-shadow:var(--shadow-lg);animation:toastIn 0.3s cubic-bezier(0.34,1.56,0.64,1);display:flex;align-items:center;gap:8px}
@keyframes toastIn{from{transform:translateX(20px);opacity:0}to{transform:translateX(0);opacity:1}}
.toast-success{border-left:4px solid #34D399}.toast-error{border-left:4px solid #F87171}
::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--mist);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--fog)}
@media(max-width:900px){:root{--nav-w:0px}#sidebar{display:none}#main{padding:18px}.dashboard-grid{grid-template-columns:1fr}.quick-stats{grid-template-columns:repeat(2,1fr)}.offering-grid{grid-template-columns:1fr}#view-toggle .view-btn span.label-text{display:none}.offering-table{font-size:12px}.offering-table td,.offering-table th{padding:7px 8px}.detail-two-col{grid-template-columns:1fr}.kd-grid{grid-template-columns:1fr}.detail-prev-next button{max-width:80px}}
</style>
</head>
<body>
<div id="app">
  <header id="header">
    <div id="logo"><div id="logo-mark">A</div><div><div id="logo-text">Alts Fund Link</div><div id="logo-sub">Intelligence Platform</div></div></div>
    <div id="view-toggle">
      <button class="view-btn active" data-view="advisor" onclick="switchMode('advisor')"><span class="view-dot"></span><span class="label-text">Advisor View</span></button>
      <button class="view-btn client-report" data-view="client_report" onclick="switchMode('client_report')"><span class="view-dot"></span><span class="label-text">Client Report</span></button>
      <button class="view-btn compliance" data-view="compliance" onclick="switchMode('compliance')"><span class="view-dot"></span><span class="label-text">Compliance</span></button>
    </div>
    <div id="data-status"><span class="pulse-dot loading" id="status-dot"></span><span id="status-text">Loading data‚Ä¶</span></div>
    <div id="client-badge" onclick="openProfileModal()"><div id="client-badge-icon">?</div><div id="client-badge-text"><span id="badge-name">No Client</span><small id="badge-equity">Set up client profile</small></div></div>
  </header>
  <div id="body-area">
    <nav id="sidebar"><div id="nav-advisor" class="nav-content"></div><div id="nav-client_report" class="nav-content" style="display:none"></div><div id="nav-compliance" class="nav-content" style="display:none"></div></nav>
    <main id="main"><div id="view-content" class="fade-in"></div></main>
  </div>
</div>
<div id="modal-container"></div>
<div id="toast-container"></div>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE & CONFIG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SHEET_ID = '1xVFw8pFrJzcxD8CH7ainimPKD6GW9tn1bb8ggHYUfRs';
const STATE = {
  mode: 'advisor',
  view: 'dashboard',
  funds: [],
  peer: {},
  client: loadClient(),
  selectedOfferingId: null,
  basket: JSON.parse(localStorage.getItem('afl_basket') || '[]'),
  browseLayout: 'card',
  browseSort: 'y1coc_desc',
  browseFilters: { status: 'all', propType: 'all', sponsor: 'all', sector: 'all', focus: 'all', cocMin: '', cocMax: '', search: '', clientEquity: false },
  incomeChart: null
};

function loadClient() {
  try { return JSON.parse(localStorage.getItem('afl_client')) || {}; } catch { return {}; }
}
function saveClient() { localStorage.setItem('afl_client', JSON.stringify(STATE.client)); }
function saveBasket() { localStorage.setItem('afl_basket', JSON.stringify(STATE.basket)); }
function fmtPct(v) { return v != null && !isNaN(v) ? v.toFixed(2) + '%' : '‚Äî'; }
function fmtMoney(v) { if (v == null || isNaN(v)) return '‚Äî'; if (v >= 1e6) return '$' + (v / 1e6).toFixed(1) + 'M'; if (v >= 1e3) return '$' + (v / 1e3).toFixed(0) + 'K'; return '$' + v.toLocaleString(); }
function fmtMoneyFull(v) { return v != null && !isNaN(v) ? '$' + v.toLocaleString() : '‚Äî'; }
function fmtNum(v, d = 2) { return v != null && !isNaN(v) ? v.toFixed(d) : '‚Äî'; }
function parsePct(s) { if (s == null || s === '') return null; let str = String(s).trim(); let hadPct = str.includes('%'); let n = parseFloat(str.replace(/[%,]/g, '')); if (isNaN(n)) return null; if (!hadPct && Math.abs(n) <= 1 && n !== 0) n = n * 100; return n; }
function parseMoney(s) { if (s == null || s === '') return null; let str = String(s).trim().replace(/[$,]/g, ''); let n = parseFloat(str); if (isNaN(n)) return null; return n; }
function parseMoneyM(s) { if (s == null || s === '') return null; let str = String(s).trim().replace(/[$,]/g, ''); let n = parseFloat(str); if (isNaN(n)) return null; if (n > 0 && n < 999) n = n * 1000000; return n; }
function parseDate(s) { if (!s) return null; if (typeof s === 'string' && s.startsWith('Date(')) { let parts = s.replace('Date(','').replace(')','').split(',').map(Number); return new Date(parts[0], parts[1], parts[2]); } let d = new Date(s); return isNaN(d) ? null : d; }
function peerDelta(val, avg, unit) { if (val == null || avg == null) return ''; let d = val - avg; let u = unit || '%'; let arrow = d > 0.1 ? '‚Üë' : d < -0.1 ? '‚Üì' : '~'; let cls = d > 0.1 ? 'up' : d < -0.1 ? 'down' : 'neutral'; return `<span class="peer-delta ${cls}">${arrow} ${Math.abs(d).toFixed(1)}${u} vs avg</span>`; }
function toast(msg, type = 'success') { let t = document.createElement('div'); t.className = 'toast toast-' + type; t.innerHTML = (type === 'success' ? '‚úì' : '‚ö†') + ' ' + msg; document.getElementById('toast-container').appendChild(t); setTimeout(() => t.remove(), 3200); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DATA LAYER ‚Äî Google Sheets via GViz
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function fetchSheetData() {
  const dot = document.getElementById('status-dot');
  const txt = document.getElementById('status-text');
  dot.className = 'pulse-dot loading'; txt.textContent = 'Loading data‚Ä¶';
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
  fetch(url)
    .then(r => r.text())
    .then(raw => {
      const json = JSON.parse(raw.substring(raw.indexOf('{'), raw.lastIndexOf('}') + 1));
      const cols = json.table.cols.map(c => c.label || '');
      const rows = json.table.rows;
      STATE.funds = rows.map((row, idx) => {
        const g = (label) => { let ci = cols.findIndex(c => c.trim() === label.trim()); return ci >= 0 && row.c[ci] ? (row.c[ci].v ?? null) : null; };
        const gf = (label) => { let ci = cols.findIndex(c => c.trim() === label.trim()); return ci >= 0 && row.c[ci] ? (row.c[ci].f || row.c[ci].v || null) : null; };
        const income = [];
        for (let y = 1; y <= 10; y++) { income.push(parsePct(g('Year ' + y))); }
        if (income[0] == null) income[0] = parsePct(g('Year 1 Cash on Cash'));

        // Status: derive from dates + structure
        let status = 'Open';
        const oClose = parseDate(gf('Offering Close'));
        const oOpen = parseDate(gf('Offering Open'));
        const struct = g('Offering Structure') || '';
        const now = new Date();
        if (oOpen && oOpen > now) status = 'Coming Soon';
        else if (oClose && oClose < now) status = 'Closed';
        else if (oClose) { const daysLeft = (oClose - now) / 86400000; if (daysLeft < 60) status = 'Closing'; }

        // Compute pctRaised from Filed vs Remaining
        const filedRaise = parseMoneyM(g('Filed Raise'));
        const currentRaise = parseMoneyM(g('Current Raise'));
        const remainingRaise = parseMoneyM(g('Remaining Raise'));
        const totalRaise = currentRaise || filedRaise;
        let pctRaised = null;
        let pctRemaining = null;
        if (filedRaise && remainingRaise != null) {
          pctRemaining = Math.round((remainingRaise / filedRaise) * 100);
          pctRaised = 100 - pctRemaining;
          if (pctRemaining < 0) pctRemaining = 0;
          if (pctRemaining > 100) pctRemaining = 100;
          if (pctRaised < 0) pctRaised = 0;
          if (pctRaised > 100) pctRaised = 100;
        }

        // Compute months on market
        let monthsOnMarket = null;
        if (oOpen) { monthsOnMarket = Math.round((now - oOpen) / (30.44 * 86400000)); if (monthsOnMarket < 0) monthsOnMarket = null; }

        return {
          id: idx,
          name: g('Offering Name') || 'Unnamed',
          sponsor: g('Sponsor') || '',
          status: status,
          propType: g('Asset Class') || '',
          sector: g('Sector') || '',
          focus: g('Focus') || '',
          location: g('Property Location(s)') || '',
          y1coc: parsePct(g('Year 1 Cash on Cash')),
          avgCoc: null,
          minInvest: parseMoney(g('Minimum - DST')),
          totalRaise: totalRaise,
          filedRaise: filedRaise,
          currentRaise: currentRaise,
          equityRemaining: remainingRaise,
          pctRaised: pctRaised,
          pctRemaining: pctRemaining,
          ltv: parsePct(g('Loan to Value')),
          dscr: null,
          dscrStress: null,
          holdPeriod: parseInt(g('Hold Period')) || null,
          occupancy: parsePct(g('% Leased')),
          purchasePrice: parseMoneyM(g('Purchase Price (Unloaded)')),
          appraisedValue: parseMoneyM(g('Appraised Valuation')),
          loadedPrice: parseMoneyM(g('Loaded Price')),
          units: parseInt(g('# Assets')) || null,
          sqft: null,
          pricePerUnit: null,
          pricePerSqFt: null,
          acqCapRate: parsePct(g('Acquisition Cap Rate')),
          avgLeaseTerm: parseFloat(g('Average Lease Term Remaining')) || null,
          tenantCredit: '',
          leaseTerms: g('Lease Terms') || '',
          debtTerms: g('Debt Terms') || '',
          rentEscalations: g('Rent Escalations') || '',
          distFrequency: g('Distribution Frequency') || '',
          preferred: g('Preferred') || '',
          promote: g('Promote') || '',
          upReit: g('721 UpREIT') || '',
          exemption: g('Exemption') || '',
          taxReporting: g('Tax Reporting') || '',
          repComp: g('Rep Comp') || '',
          salesLoad: g('Sales Load') || '',
          reserve: g('Reserve') || '',
          gpCommit: g('GP Commit') || '',
          buildingAge: g('Building Age (Avg)') || '',
          brochureUrl: g('Brochure'),
          ppmUrl: g('PPM'),
          trackRecordUrl: g('Track Record'),
          salesTeamUrl: g('Sales Team Map'),
          videoUrl: g('Video'),
          sponsorNewsUrl: g('Sponsor News'),
          aiChatUrl: g('AI Offering Chat'),
          sponsorAum: g('Sponsor AUM') || '',
          sponsorOfferings: g('Number of Sponsor Offerings') || '',
          sponsorExits: g('Sponsor Full Cycle Exits') || '',
          sponsorAvgIrr: parsePct(g('Sponsor Average IRR')),
          sponsorBestIrr: parsePct(g('Sponsor Best IRR')),
          sponsorWorstIrr: parsePct(g('Sponsor Worst IRR')),
          sponsorExperience: g('Sponsor Experience') || '',
          openDate: oOpen,
          closeDate: oClose,
          monthsOnMarket: monthsOnMarket,
          income: income,
          _raw: row.c
        };
      }).filter(f => f.name !== 'Unnamed');
      computePeerStats();
      dot.className = 'pulse-dot'; txt.textContent = STATE.funds.length + ' offerings live';
      renderApp();
    })
    .catch(err => {
      console.error('Fetch error:', err);
      dot.className = 'pulse-dot error'; txt.textContent = 'Data error';
    });
}

function computePeerStats() {
  const fs = STATE.funds;
  const vals = (fn) => fs.map(fn).filter(v => v != null);
  const avg = (arr) => arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : null;
  STATE.peer = {
    avgY1CoC: avg(vals(f => f.y1coc)),
    avgLTV: avg(vals(f => f.ltv)),
    avgOccupancy: avg(vals(f => f.occupancy)),
    avgMinInvest: avg(vals(f => f.minInvest)),
    avgDSCR: avg(vals(f => f.dscr)),
    avgHold: avg(vals(f => f.holdPeriod)),
    avgLeaseTerm: avg(vals(f => f.avgLeaseTerm)),
    count: fs.length
  };
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NAVIGATION & RENDER ENGINE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function switchMode(mode) {
  STATE.mode = mode;
  document.querySelectorAll('.view-btn').forEach(b => b.classList.toggle('active', b.dataset.view === mode));
  const sb = document.getElementById('sidebar');
  sb.className = mode === 'compliance' ? 'compliance-mode' : mode === 'client_report' ? 'report-mode' : '';
  document.querySelectorAll('.nav-content').forEach(n => n.style.display = 'none');
  document.getElementById('nav-' + mode).style.display = '';
  STATE.view = mode === 'advisor' ? 'dashboard' : mode === 'client_report' ? 'report_summary' : 'comp_dashboard';
  renderApp();
}

function navigateTo(view, offeringId) {
  STATE.view = view;
  if (offeringId !== undefined) STATE.selectedOfferingId = offeringId;
  renderApp();
}

function renderApp() {
  buildNav();
  const container = document.getElementById('view-content');
  container.className = 'fade-in' + (STATE.mode === 'compliance' ? ' compliance-mode' : '');
  let html = '';
  switch (STATE.view) {
    case 'dashboard': html = renderDashboard(); break;
    case 'browse': html = renderBrowse(); break;
    case 'offering_detail': html = renderOfferingDetail(); break;
    case 'basket': html = renderBasket(); break;
    default: html = renderPlaceholder(STATE.view);
  }
  container.innerHTML = html;
  attachViewHandlers();
}

function renderPlaceholder(view) {
  const labels = {
    portfolio_builder: 'Portfolio Builder', model: 'Model for Client', comp_dashboard: 'Compliance Dashboard',
    comp_review: 'Offering Review Queue', comp_reports: 'Compliance Reports', comp_audit: 'Audit Trail',
    report_summary: 'Client Report Summary', report_builder: 'Report Builder', report_templates: 'Report Templates'
  };
  return `<div class="empty-state"><div class="empty-state-icon">üöß</div><h3>${labels[view] || view}</h3><p>Coming in Phase 2. This module will be built out in the next development sprint.</p></div>`;
}

function buildNav() {
  const advisorNav = [
    { icon: 'üìä', label: 'Dashboard', view: 'dashboard' },
    { icon: 'üîç', label: 'Browse Offerings', view: 'browse', badge: STATE.funds.length },
    { icon: 'üõí', label: 'Basket', view: 'basket', badge: STATE.basket.length || null },
    { icon: 'üìê', label: 'Portfolio Builder', view: 'portfolio_builder' },
    { icon: 'üßÆ', label: 'Model for Client', view: 'model' }
  ];
  const compNav = [
    { icon: 'üõ°Ô∏è', label: 'Dashboard', view: 'comp_dashboard' },
    { icon: 'üìã', label: 'Offering Review', view: 'comp_review' },
    { icon: 'üìä', label: 'Reports', view: 'comp_reports' },
    { icon: 'üìú', label: 'Audit Trail', view: 'comp_audit' }
  ];
  const reportNav = [
    { icon: 'üìÑ', label: 'Summary', view: 'report_summary' },
    { icon: 'üõ†Ô∏è', label: 'Builder', view: 'report_builder' },
    { icon: 'üìã', label: 'Templates', view: 'report_templates' }
  ];
  const renderNavItems = (items) => items.map(i => `<button class="nav-item ${STATE.view === i.view ? 'active' : ''}" onclick="navigateTo('${i.view}')"><span class="nav-icon">${i.icon}</span>${i.label}${i.badge ? `<span class="nav-badge">${i.badge}</span>` : ''}</button>`).join('');
  document.getElementById('nav-advisor').innerHTML = `<div class="nav-section"><div class="nav-label">Platform</div>${renderNavItems(advisorNav)}</div>`;
  document.getElementById('nav-compliance').innerHTML = `<div class="nav-section"><div class="nav-label">Compliance</div>${renderNavItems(compNav)}</div>`;
  document.getElementById('nav-client_report').innerHTML = `<div class="nav-section"><div class="nav-label">Client Reports</div>${renderNavItems(reportNav)}</div>`;
}

function updateClientBadge() {
  const c = STATE.client;
  const icon = document.getElementById('client-badge-icon');
  const name = document.getElementById('badge-name');
  const eq = document.getElementById('badge-equity');
  if (c.name) {
    icon.textContent = c.name.split(' ').map(w => w[0]).join('').substring(0, 2);
    name.textContent = c.name;
    eq.textContent = c.exchangeAmount ? fmtMoney(c.exchangeAmount) + ' exchange' : c.firm || 'Client active';
  } else {
    icon.textContent = '?'; name.textContent = 'No Client'; eq.textContent = 'Set up client profile';
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CLIENT PROFILE MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openProfileModal() {
  const c = STATE.client;
  document.getElementById('modal-container').innerHTML = `
    <div class="modal-overlay" onclick="if(event.target===this)closeModal()">
      <div class="modal">
        <div class="modal-header"><div><div class="modal-title">Client Profile</div><div class="modal-subtitle">Configure client parameters for suitability matching</div></div><button class="modal-close" onclick="closeModal()">‚úï</button></div>
        <div class="modal-body">
          <div class="form-grid">
            <div class="form-group"><label class="form-label">Client Name</label><input class="form-input" id="cp-name" value="${c.name || ''}" placeholder="Full name"></div>
            <div class="form-group"><label class="form-label">Firm / BD</label><input class="form-input" id="cp-firm" value="${c.firm || ''}" placeholder="Broker-dealer"></div>
            <div class="form-group"><label class="form-label">Age</label><input class="form-input" type="number" id="cp-age" value="${c.age || ''}" placeholder="65"></div>
            <div class="form-group"><label class="form-label">Filing Status</label><select class="form-select" id="cp-filing"><option value="">Select</option><option value="single" ${c.filing === 'single' ? 'selected' : ''}>Single</option><option value="married" ${c.filing === 'married' ? 'selected' : ''}>Married Filing Jointly</option><option value="trust" ${c.filing === 'trust' ? 'selected' : ''}>Trust</option></select></div>
            <div class="form-group"><label class="form-label">1031 Exchange Amount</label><input class="form-input" id="cp-exchange" value="${c.exchangeAmount || ''}" placeholder="$500,000"></div>
            <div class="form-group"><label class="form-label">Annual Income</label><input class="form-input" id="cp-income" value="${c.annualIncome || ''}" placeholder="$200,000"></div>
            <div class="form-group"><label class="form-label">Net Worth</label><input class="form-input" id="cp-networth" value="${c.netWorth || ''}" placeholder="$2,000,000"></div>
            <div class="form-group"><label class="form-label">Risk Tolerance</label><select class="form-select" id="cp-risk"><option value="">Select</option><option value="conservative" ${c.riskTolerance === 'conservative' ? 'selected' : ''}>Conservative</option><option value="moderate" ${c.riskTolerance === 'moderate' ? 'selected' : ''}>Moderate</option><option value="growth" ${c.riskTolerance === 'growth' ? 'selected' : ''}>Growth</option></select></div>
            <div class="form-group"><label class="form-label">Investment Horizon</label><select class="form-select" id="cp-horizon"><option value="">Select</option><option value="short" ${c.horizon === 'short' ? 'selected' : ''}>Short (3-5 yr)</option><option value="medium" ${c.horizon === 'medium' ? 'selected' : ''}>Medium (5-10 yr)</option><option value="long" ${c.horizon === 'long' ? 'selected' : ''}>Long (10+ yr)</option></select></div>
            <div class="form-group"><label class="form-label">State</label><input class="form-input" id="cp-state" value="${c.state || ''}" placeholder="CA, TX, FL..."></div>
            <div class="form-group form-grid-full"><label class="form-label">Investment Objective</label><div class="checkbox-group" id="cp-objectives">${['Income', 'Preservation', 'Growth', 'Tax Deferral', 'Diversification', 'Estate Planning'].map(o => `<label class="checkbox-pill ${(c.objectives || []).includes(o) ? 'checked' : ''}" onclick="this.classList.toggle('checked')"><input type="checkbox" value="${o}" ${(c.objectives || []).includes(o) ? 'checked' : ''}>${o}</label>`).join('')}</div></div>
            <div class="form-group form-grid-full"><label class="form-label">Property Type Preferences</label><div class="checkbox-group" id="cp-proptypes">${['Multifamily', 'Industrial', 'NNN Retail', 'Medical', 'Office', 'Self-Storage', 'Hospitality', 'Senior Living', 'Student Housing'].map(p => `<label class="checkbox-pill ${(c.propTypes || []).includes(p) ? 'checked' : ''}" onclick="this.classList.toggle('checked')"><input type="checkbox" value="${p}" ${(c.propTypes || []).includes(p) ? 'checked' : ''}>${p}</label>`).join('')}</div></div>
            <div class="form-group form-grid-full"><label class="form-label">Notes</label><textarea class="form-input" id="cp-notes" style="height:60px;padding:10px;resize:vertical" placeholder="Additional notes...">${c.notes || ''}</textarea></div>
          </div>
        </div>
        <div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="saveProfile()">üíæ Save Profile</button></div>
      </div>
    </div>`;
}

function saveProfile() {
  STATE.client = {
    name: document.getElementById('cp-name').value.trim(),
    firm: document.getElementById('cp-firm').value.trim(),
    age: parseInt(document.getElementById('cp-age').value) || null,
    filing: document.getElementById('cp-filing').value,
    exchangeAmount: parseMoney(document.getElementById('cp-exchange').value),
    annualIncome: parseMoney(document.getElementById('cp-income').value),
    netWorth: parseMoney(document.getElementById('cp-networth').value),
    riskTolerance: document.getElementById('cp-risk').value,
    horizon: document.getElementById('cp-horizon').value,
    state: document.getElementById('cp-state').value.trim(),
    objectives: [...document.querySelectorAll('#cp-objectives .checked input')].map(i => i.value),
    propTypes: [...document.querySelectorAll('#cp-proptypes .checked input')].map(i => i.value),
    notes: document.getElementById('cp-notes').value.trim()
  };
  saveClient();
  updateClientBadge();
  closeModal();
  toast('Client profile saved');
  if (STATE.view === 'dashboard') renderApp();
}

function closeModal() { document.getElementById('modal-container').innerHTML = ''; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DASHBOARD VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderDashboard() {
  const c = STATE.client;
  const fs = STATE.funds;
  const hasClient = !!c.name;
  const profileCard = `
    <div class="profile-card">
      <div class="profile-card-header"><h3>Active Client</h3>
        <div class="profile-card-name">${c.name || 'No Client Set'}</div>
        <div class="profile-card-firm">${c.firm || 'Configure client profile to begin'}</div>
      </div>
      <div class="profile-card-body">
        ${hasClient ? `
          ${c.exchangeAmount ? `<div class="profile-row"><span class="profile-key">1031 Exchange</span><span class="profile-val">${fmtMoney(c.exchangeAmount)}</span></div>` : ''}
          ${c.age ? `<div class="profile-row"><span class="profile-key">Age</span><span class="profile-val">${c.age}</span></div>` : ''}
          ${c.riskTolerance ? `<div class="profile-row"><span class="profile-key">Risk Tolerance</span><span class="profile-val" style="text-transform:capitalize">${c.riskTolerance}</span></div>` : ''}
          ${c.horizon ? `<div class="profile-row"><span class="profile-key">Horizon</span><span class="profile-val" style="text-transform:capitalize">${c.horizon}</span></div>` : ''}
          ${c.objectives && c.objectives.length ? `<div class="profile-row"><span class="profile-key">Objectives</span><span class="profile-val" style="font-size:11px">${c.objectives.join(', ')}</span></div>` : ''}
          ${c.state ? `<div class="profile-row"><span class="profile-key">State</span><span class="profile-val">${c.state}</span></div>` : ''}
        ` : '<div style="text-align:center;padding:12px 0;color:var(--slate2);font-size:13px">Click to set up client profile</div>'}
      </div>
      <div class="profile-card-footer">
        <button class="btn btn-secondary btn-sm" onclick="openProfileModal()" style="flex:1">‚úèÔ∏è ${hasClient ? 'Edit' : 'Set Up'} Profile</button>
        ${hasClient ? `<button class="btn btn-ghost btn-sm" onclick="clearClient()">Clear</button>` : ''}
      </div>
    </div>`;

  const suitScores = hasClient ? fs.slice(0, 5).map(f => {
    let score = 50;
    if (c.riskTolerance === 'conservative' && f.ltv && f.ltv < 60) score += 15;
    if (c.riskTolerance === 'conservative' && f.ltv && f.ltv > 70) score -= 20;
    if (c.riskTolerance === 'growth' && f.y1coc && f.y1coc > 6) score += 15;
    if (c.exchangeAmount && f.minInvest && f.minInvest <= c.exchangeAmount * 0.3) score += 10;
    if (c.propTypes && c.propTypes.length && c.propTypes.some(p => f.propType.toLowerCase().includes(p.toLowerCase()))) score += 15;
    if (c.objectives && c.objectives.includes('Income') && f.y1coc && f.y1coc > (STATE.peer.avgY1CoC || 5)) score += 10;
    if (c.age && f.holdPeriod && (c.age + f.holdPeriod) > 85) score -= 15;
    score = Math.max(10, Math.min(98, score));
    return { ...f, suitScore: score };
  }).sort((a, b) => b.suitScore - a.suitScore) : [];

  const topPicks = hasClient ? suitScores.slice(0, 3).map((f, i) => `
    <div class="offering-card card-enter" style="animation-delay:${i * 0.08}s" onclick="navigateTo('offering_detail',${f.id})">
      <div class="offering-card-header">
        <div><div class="offering-name">${f.name}</div><div class="offering-sponsor">${f.sponsor}</div></div>
        <span class="suit-score ${f.suitScore >= 70 ? 'high' : f.suitScore >= 45 ? 'medium' : 'low'}">${f.suitScore}% match</span>
      </div>
      <div class="offering-metrics">
        <div class="offering-metric-item"><div class="label">Y1 CoC</div><div class="value">${fmtPct(f.y1coc)}</div></div>
        <div class="offering-metric-item"><div class="label">LTV</div><div class="value">${fmtPct(f.ltv)}</div></div>
      </div>
      <div class="offering-badges"><span class="badge badge-navy">${f.propType || 'DST'}</span><span class="badge badge-green">${f.status}</span></div>
    </div>
  `).join('') : '';

  const statsHtml = `
    <div class="quick-stats">
      <div class="stat-card card-enter" style="animation-delay:0s"><div class="stat-val">${fs.length}</div><div class="stat-label">Active Offerings</div></div>
      <div class="stat-card card-enter" style="animation-delay:0.06s"><div class="stat-val">${fmtPct(STATE.peer.avgY1CoC)}</div><div class="stat-label">Avg Y1 CoC</div></div>
      <div class="stat-card card-enter" style="animation-delay:0.12s"><div class="stat-val">${STATE.basket.length}</div><div class="stat-label">In Basket</div></div>
      <div class="stat-card card-enter" style="animation-delay:0.18s"><div class="stat-val">${fs.filter(f => f.status === 'Open').length}</div><div class="stat-label">Open Now</div></div>
    </div>`;

  return `
    <div class="page-header"><div><div class="page-title">Dashboard</div><div class="page-subtitle">${hasClient ? 'Personalized for ' + c.name : 'Set up a client profile to enable matching'}</div></div></div>
    ${statsHtml}
    <div class="dashboard-grid">
      ${profileCard}
      <div>
        ${hasClient ? `
          <div class="suggested-header"><div><div class="suggested-title">Top Matches</div><div class="suggested-sub">Based on client profile suitability</div></div>
            <button class="btn btn-secondary btn-sm" onclick="navigateTo('browse')">View All ‚Üí</button>
          </div>
          <div class="offering-grid" style="grid-template-columns:repeat(auto-fill,minmax(240px,1fr))">${topPicks}</div>
        ` : `
          <div class="start-here-card"><div class="start-here-icon">üéØ</div><div class="start-here-title">Start by Setting Up a Client</div>
            <div class="start-here-text">Configure your client's profile ‚Äî age, exchange amount, risk tolerance, and property preferences ‚Äî to unlock personalized DST matching and suitability scores across all ${fs.length} offerings.</div>
            <button class="btn btn-primary" onclick="openProfileModal()">‚öôÔ∏è Set Up Client Profile</button>
          </div>
        `}
      </div>
    </div>`;
}

function clearClient() { STATE.client = {}; saveClient(); updateClientBadge(); renderApp(); toast('Client cleared'); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BROWSE VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function getFilteredFunds() {
  const f = STATE.browseFilters;
  let funds = [...STATE.funds];
  if (f.status !== 'all') funds = funds.filter(x => x.status === f.status);
  if (f.propType !== 'all') funds = funds.filter(x => x.propType.toLowerCase().includes(f.propType.toLowerCase()));
  if (f.sponsor !== 'all') funds = funds.filter(x => x.sponsor === f.sponsor);
  if (f.sector !== 'all') funds = funds.filter(x => x.sector === f.sector);
  if (f.focus !== 'all') funds = funds.filter(x => x.focus === f.focus);
  if (f.cocMin) funds = funds.filter(x => x.y1coc != null && x.y1coc >= parseFloat(f.cocMin));
  if (f.cocMax) funds = funds.filter(x => x.y1coc != null && x.y1coc <= parseFloat(f.cocMax));
  if (f.clientEquity && STATE.client.exchangeAmount) funds = funds.filter(x => x.minInvest && x.minInvest <= STATE.client.exchangeAmount);
  if (f.search) { let s = f.search.toLowerCase(); funds = funds.filter(x => x.name.toLowerCase().includes(s) || x.sponsor.toLowerCase().includes(s) || x.propType.toLowerCase().includes(s) || x.location.toLowerCase().includes(s)); }
  const sortMap = {
    y1coc_desc: (a, b) => (b.y1coc || 0) - (a.y1coc || 0),
    y1coc_asc: (a, b) => (a.y1coc || 0) - (b.y1coc || 0),
    ltv_asc: (a, b) => (a.ltv || 999) - (b.ltv || 999),
    ltv_desc: (a, b) => (b.ltv || 0) - (a.ltv || 0),
    min_asc: (a, b) => (a.minInvest || 999999) - (b.minInvest || 999999),
    name_asc: (a, b) => a.name.localeCompare(b.name),
    status: (a, b) => { const o = { 'Open': 0, 'Closing': 1, 'Coming Soon': 2 }; return (o[a.status] || 9) - (o[b.status] || 9); }
  };
  funds.sort(sortMap[STATE.browseSort] || sortMap.y1coc_desc);
  return funds;
}

function renderBrowse() {
  const funds = getFilteredFunds();
  const sponsors = [...new Set(STATE.funds.map(f => f.sponsor).filter(Boolean))].sort();
  const propTypes = [...new Set(STATE.funds.map(f => f.propType).filter(Boolean))].sort();
  const sectors = [...new Set(STATE.funds.map(f => f.sector).filter(Boolean))].sort();
  const focuses = [...new Set(STATE.funds.map(f => f.focus).filter(Boolean))].sort();
  const f = STATE.browseFilters;
  const activeFilters = [];
  if (f.status !== 'all') activeFilters.push({ label: f.status, key: 'status' });
  if (f.propType !== 'all') activeFilters.push({ label: f.propType, key: 'propType' });
  if (f.sponsor !== 'all') activeFilters.push({ label: f.sponsor, key: 'sponsor' });
  if (f.sector !== 'all') activeFilters.push({ label: f.sector, key: 'sector' });
  if (f.focus !== 'all') activeFilters.push({ label: f.focus, key: 'focus' });
  if (f.cocMin || f.cocMax) activeFilters.push({ label: `CoC ${f.cocMin || '0'}‚Äì${f.cocMax || '‚àû'}%`, key: 'coc' });
  if (f.clientEquity) activeFilters.push({ label: 'Fits Exchange', key: 'clientEquity' });

  const filterHtml = `
    <div class="filter-bar">
      <input class="search-input" placeholder="Search offerings..." value="${f.search}" oninput="STATE.browseFilters.search=this.value;renderApp()">
      <select class="filter-select" onchange="STATE.browseFilters.status=this.value;renderApp()">
        <option value="all" ${f.status === 'all' ? 'selected' : ''}>All Status</option>
        <option value="Open" ${f.status === 'Open' ? 'selected' : ''}>Open</option>
        <option value="Closing" ${f.status === 'Closing' ? 'selected' : ''}>Closing</option>
        <option value="Coming Soon" ${f.status === 'Coming Soon' ? 'selected' : ''}>Coming Soon</option>
      </select>
      <select class="filter-select" onchange="STATE.browseFilters.propType=this.value;renderApp()">
        <option value="all" ${f.propType === 'all' ? 'selected' : ''}>All Types</option>
        ${propTypes.map(p => `<option value="${p}" ${f.propType === p ? 'selected' : ''}>${p}</option>`).join('')}
      </select>
      <select class="filter-select" onchange="STATE.browseFilters.sponsor=this.value;renderApp()">
        <option value="all" ${f.sponsor === 'all' ? 'selected' : ''}>All Sponsors</option>
        ${sponsors.map(s => `<option value="${s}" ${f.sponsor === s ? 'selected' : ''}>${s}</option>`).join('')}
      </select>
      <select class="filter-select" onchange="STATE.browseFilters.sector=this.value;renderApp()">
        <option value="all" ${f.sector === 'all' ? 'selected' : ''}>All Sectors</option>
        ${sectors.map(s => `<option value="${s}" ${f.sector === s ? 'selected' : ''}>${s}</option>`).join('')}
      </select>
      <select class="filter-select" onchange="STATE.browseFilters.focus=this.value;renderApp()">
        <option value="all" ${f.focus === 'all' ? 'selected' : ''}>All Focus</option>
        ${focuses.map(s => `<option value="${s}" ${f.focus === s ? 'selected' : ''}>${s}</option>`).join('')}
      </select>
    </div>
    <div class="filter-row-2">
      <div class="range-filter"><span>CoC</span><input placeholder="min" value="${f.cocMin}" oninput="STATE.browseFilters.cocMin=this.value;renderApp()"><span>‚Äì</span><input placeholder="max" value="${f.cocMax}" oninput="STATE.browseFilters.cocMax=this.value;renderApp()"><span>%</span></div>
      ${STATE.client.exchangeAmount ? `<div class="equity-filter ${f.clientEquity ? 'active' : ''}" onclick="STATE.browseFilters.clientEquity=!STATE.browseFilters.clientEquity;renderApp()">üí∞ Fits ${fmtMoney(STATE.client.exchangeAmount)}</div>` : ''}
      <div style="flex:1"></div>
      <select class="sort-select" onchange="STATE.browseSort=this.value;renderApp()">
        <option value="y1coc_desc" ${STATE.browseSort === 'y1coc_desc' ? 'selected' : ''}>CoC: High ‚Üí Low</option>
        <option value="y1coc_asc" ${STATE.browseSort === 'y1coc_asc' ? 'selected' : ''}>CoC: Low ‚Üí High</option>
        <option value="ltv_asc" ${STATE.browseSort === 'ltv_asc' ? 'selected' : ''}>LTV: Low ‚Üí High</option>
        <option value="ltv_desc" ${STATE.browseSort === 'ltv_desc' ? 'selected' : ''}>LTV: High ‚Üí Low</option>
        <option value="min_asc" ${STATE.browseSort === 'min_asc' ? 'selected' : ''}>Min Invest: Low ‚Üí High</option>
        <option value="name_asc" ${STATE.browseSort === 'name_asc' ? 'selected' : ''}>Name: A ‚Üí Z</option>
        <option value="status" ${STATE.browseSort === 'status' ? 'selected' : ''}>Status</option>
      </select>
      <div class="view-toggle-group">
        <button class="view-toggle-btn ${STATE.browseLayout === 'card' ? 'active' : ''}" onclick="STATE.browseLayout='card';renderApp()">‚ñ¶</button>
        <button class="view-toggle-btn ${STATE.browseLayout === 'table' ? 'active' : ''}" onclick="STATE.browseLayout='table';renderApp()">‚ò∞</button>
      </div>
    </div>`;

  const resultBar = `<div class="result-bar"><span class="result-count">${funds.length}</span> offerings${activeFilters.length ? ' ¬∑ <span class="active-filter-chips">' + activeFilters.map(a => `<span class="filter-chip">${a.label}<button onclick="clearFilter('${a.key}')">‚úï</button></span>`).join('') + '</span>' : ''}</div>`;

  let listHtml = '';
  if (STATE.browseLayout === 'card') {
    listHtml = `<div class="offering-grid">${funds.map((fund, i) => renderOfferingCard(fund, i)).join('')}</div>`;
  } else {
    listHtml = renderOfferingTable(funds);
  }

  return `<div class="page-header"><div><div class="page-title">Browse Offerings</div><div class="page-subtitle">All active DST offerings from approved sponsors</div></div></div>${filterHtml}${resultBar}${listHtml}`;
}

function clearFilter(key) {
  if (key === 'coc') { STATE.browseFilters.cocMin = ''; STATE.browseFilters.cocMax = ''; }
  else if (key === 'clientEquity') STATE.browseFilters.clientEquity = false;
  else STATE.browseFilters[key] = 'all';
  renderApp();
}

function renderOfferingCard(fund, i) {
  const inBasket = STATE.basket.includes(fund.id);
  const statusCls = fund.status === 'Open' ? 'open' : fund.status === 'Closing' ? 'closing' : 'coming';
  const pctRaised = fund.pctRaised; const pctRemaining = fund.pctRemaining;
  return `
    <div class="offering-card card-enter" style="animation-delay:${Math.min(i * 0.04, 0.5)}s" onclick="navigateTo('offering_detail',${fund.id})">
      <div class="card-status-strip ${statusCls}"></div>
      <div class="offering-card-header">
        <div><div class="offering-name">${fund.name}</div><div class="offering-sponsor">${fund.sponsor}</div></div>
        <span class="badge badge-${statusCls === 'open' ? 'green' : statusCls === 'closing' ? 'amber' : 'blue'}">${fund.status}</span>
      </div>
      ${fund.location ? `<div class="offering-location">üìç ${fund.location}</div>` : ''}
      <div class="offering-metrics">
        <div class="offering-metric-item"><div class="label">Y1 CoC</div><div class="value">${fmtPct(fund.y1coc)}</div>${peerDelta(fund.y1coc, STATE.peer.avgY1CoC)}</div>
        <div class="offering-metric-item"><div class="label">LTV</div><div class="value">${fmtPct(fund.ltv)}</div>${peerDelta(fund.ltv, STATE.peer.avgLTV)}</div>
        <div class="offering-metric-item"><div class="label">Min Invest</div><div class="value">${fmtMoney(fund.minInvest)}</div></div>
        <div class="offering-metric-item"><div class="label">Hold</div><div class="value">${fund.holdPeriod ? fund.holdPeriod + ' yr' : '‚Äî'}</div></div>
      </div>
      <div class="offering-badges"><span class="badge badge-navy">${fund.propType || 'DST'}</span>${fund.occupancy ? `<span class="badge badge-green">${fmtPct(fund.occupancy)} Occupied</span>` : ''}</div>
      <div class="offering-card-footer">
        ${pctRemaining != null ? `<div style="flex:1"><div style="font-size:11px;color:var(--slate2)">${pctRemaining}% remaining${fund.equityRemaining ? ' ¬∑ ' + fmtMoney(fund.equityRemaining) : ''}</div><div class="raise-bar"><div class="raise-fill" style="width:${Math.min(100 - pctRemaining, 100)}%"></div></div></div>` : '<div style="flex:1"></div>'}
        <button class="btn btn-sm ${inBasket ? 'btn-primary' : 'btn-secondary'}" onclick="event.stopPropagation();toggleBasket(${fund.id})">${inBasket ? '‚úì In Basket' : '+ Basket'}</button>
      </div>
    </div>`;
}

function renderOfferingTable(funds) {
  const rows = funds.map(f => `
    <tr onclick="navigateTo('offering_detail',${f.id})">
      <td class="name-cell"><div>${f.name}</div><div style="font-size:11px;font-weight:400;color:var(--slate2)">${f.sponsor}</div></td>
      <td><span class="badge badge-${f.status === 'Open' ? 'green' : f.status === 'Closing' ? 'amber' : 'blue'}">${f.status}</span></td>
      <td>${f.propType}</td>
      <td class="num-cell ${f.y1coc && STATE.peer.avgY1CoC && f.y1coc > STATE.peer.avgY1CoC ? 'highlight-green' : ''}">${fmtPct(f.y1coc)}</td>
      <td class="num-cell ${f.ltv && f.ltv > 65 ? 'highlight-red' : ''}">${fmtPct(f.ltv)}</td>
      <td class="num-cell">${fmtMoney(f.minInvest)}</td>
      <td class="num-cell">${f.holdPeriod ? f.holdPeriod + 'yr' : '‚Äî'}</td>
      <td class="num-cell">${fmtPct(f.occupancy)}</td>
      <td><button class="btn btn-sm ${STATE.basket.includes(f.id) ? 'btn-primary' : 'btn-secondary'}" onclick="event.stopPropagation();toggleBasket(${f.id})">${STATE.basket.includes(f.id) ? '‚úì' : '+'}</button></td>
    </tr>`).join('');
  return `<div class="table-wrapper"><table class="offering-table"><thead><tr><th>Offering</th><th>Status</th><th>Type</th><th>Y1 CoC</th><th>LTV</th><th>Min</th><th>Hold</th><th>Occ</th><th></th></tr></thead><tbody>${rows}</tbody></table></div>`;
}

function toggleBasket(id) {
  const idx = STATE.basket.indexOf(id);
  if (idx >= 0) STATE.basket.splice(idx, 1); else STATE.basket.push(id);
  saveBasket(); renderApp();
  toast(idx >= 0 ? 'Removed from basket' : 'Added to basket');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STEP 5: OFFERING DETAIL VIEW (ENHANCED)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderOfferingDetail() {
  const fund = STATE.funds.find(f => f.id === STATE.selectedOfferingId);
  if (!fund) return `<div class="empty-state"><div class="empty-state-icon">üîç</div><h3>No Offering Selected</h3><p>Select an offering from Browse or Dashboard.</p><button class="btn btn-primary" onclick="navigateTo('browse')">Browse Offerings</button></div>`;

  const inBasket = STATE.basket.includes(fund.id);
  const p = STATE.peer;
  const curIdx = STATE.funds.findIndex(f => f.id === fund.id);
  const prevFund = curIdx > 0 ? STATE.funds[curIdx - 1] : null;
  const nextFund = curIdx < STATE.funds.length - 1 ? STATE.funds[curIdx + 1] : null;

  // ‚îÄ‚îÄ Navigation strip ‚îÄ‚îÄ
  const navStrip = `
    <div class="detail-nav-strip">
      <div class="breadcrumb">
        <span style="cursor:pointer;text-decoration:underline" onclick="navigateTo('browse')">Browse</span>
        <span>‚Ä∫</span>
        <span class="crumb-name">${fund.name}</span>
      </div>
      <div class="detail-prev-next">
        <button ${prevFund ? `onclick="navigateTo('offering_detail',${prevFund.id})"` : 'disabled'}>‚Üê ${prevFund ? prevFund.name.substring(0, 18) : 'Prev'}</button>
        <button ${nextFund ? `onclick="navigateTo('offering_detail',${nextFund.id})"` : 'disabled'}>${nextFund ? nextFund.name.substring(0, 18) : 'Next'} ‚Üí</button>
      </div>
    </div>`;

  // ‚îÄ‚îÄ Hero Header ‚îÄ‚îÄ
  const statusCls = fund.status === 'Open' ? 'green' : fund.status === 'Closing' ? 'amber' : 'blue';
  const heroTiles = [
    { label: 'Y1 Cash on Cash', value: fmtPct(fund.y1coc), delta: peerDelta(fund.y1coc, p.avgY1CoC) },
    { label: 'Loan to Value', value: fmtPct(fund.ltv), delta: peerDelta(fund.ltv, p.avgLTV) },
    { label: 'Min Investment', value: fmtMoney(fund.minInvest), delta: '' },
    { label: 'Hold Period', value: fund.holdPeriod ? fund.holdPeriod + ' yr' : '‚Äî', delta: '' }
  ];
  const hero = `
    <div class="panel detail-section" style="background:linear-gradient(135deg,var(--navy) 0%,var(--navy2) 100%);color:var(--white);border:none">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:18px;flex-wrap:wrap;gap:10px">
        <div><div style="font-size:22px;font-weight:800;letter-spacing:-0.02em">${fund.name}</div>
          <div style="font-size:13px;color:rgba(255,255,255,0.55);margin-top:3px">${fund.sponsor}${fund.location ? ' ¬∑ ' + fund.location : ''}</div></div>
        <div style="display:flex;gap:6px;flex-wrap:wrap">
          <span class="badge badge-${statusCls}">${fund.status}</span>
          <span class="badge badge-navy">${fund.propType || 'DST'}</span>
        </div>
      </div>
      <div class="metric-grid" style="grid-template-columns:repeat(4,1fr)">
        ${heroTiles.map(t => `<div class="metric-tile" style="background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.12)"><div class="metric-label" style="color:rgba(255,255,255,0.5)">${t.label}</div><div class="metric-value" style="color:#fff">${t.value}</div>${t.delta ? `<div style="margin-top:3px">${t.delta}</div>` : ''}</div>`).join('')}
      </div>
    </div>`;

  // ‚îÄ‚îÄ Document Buttons & Action Bar ‚îÄ‚îÄ
  const docBtns = [
    { label: 'Brochure', url: fund.brochureUrl, icon: 'üìÑ' },
    { label: 'PPM', url: fund.ppmUrl, icon: 'üìã' },
    { label: 'Track Record', url: fund.trackRecordUrl, icon: 'üìä' },
    { label: 'Sales Team', url: fund.salesTeamUrl, icon: 'üë•' },
    { label: 'Video', url: fund.videoUrl, icon: 'üé¨' },
    { label: 'Sponsor News', url: fund.sponsorNewsUrl, icon: 'üì∞' },
    { label: 'AI Chat', url: fund.aiChatUrl, icon: 'ü§ñ' }
  ];
  const docRow = `<div class="doc-btn-row"><span class="doc-label">Documents</span>${docBtns.map(d => `<button class="btn btn-sm btn-secondary" ${d.url ? `onclick="window.open('${d.url}','_blank')"` : 'disabled style="opacity:0.4"'}>${d.icon} ${d.label}</button>`).join('')}</div>`;
  const actionBar = `<div class="action-bar">
    <button class="btn ${inBasket ? 'btn-primary' : 'btn-secondary'}" onclick="toggleBasket(${fund.id})">${inBasket ? '‚úì In Basket' : 'üõí Add to Basket'}</button>
    <button class="btn btn-secondary" onclick="toast('Portfolio Builder coming Phase 2','error')">üìê Build Portfolio</button>
    <button class="btn btn-secondary" onclick="toast('Model coming Phase 2','error')">üßÆ Model for Client</button>
    <button class="btn btn-ghost" onclick="toast('Compliance Report coming Phase 2','error')">üõ°Ô∏è Compliance Report</button>
  </div>`;

  // ‚îÄ‚îÄ Raise Progress & Timeline ‚îÄ‚îÄ
  const pctRaised = fund.pctRaised; const pctRemaining = fund.pctRemaining;
  const daysRemaining = fund.closeDate ? Math.max(0, Math.round((fund.closeDate - new Date()) / 86400000)) : null;
  const totalDays = (fund.openDate && fund.closeDate) ? Math.max(1, Math.round((fund.closeDate - fund.openDate) / 86400000)) : null;
  const pctTimeElapsed = (totalDays && daysRemaining != null) ? Math.round(((totalDays - daysRemaining) / totalDays) * 100) : null;
  const pctTimeRemaining = pctTimeElapsed != null ? (100 - pctTimeElapsed) : null;
  const raiseSection = `
    <div class="panel detail-section">
      <div class="panel-title">\u{1F4CA} Raise Progress & Timeline</div>
      <div style="display:grid;gap:24px">
        <div>
          <div style="font-size:12px;font-weight:700;color:var(--slate);text-transform:uppercase;letter-spacing:0.06em;margin-bottom:10px">Capital Raise</div>
          ${pctRemaining != null ? `
            <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px">
              <span style="font-weight:700;color:var(--navy)">${pctRemaining}% Remaining</span>
              <span style="color:var(--slate2)">${100 - pctRemaining}% Raised</span>
            </div>
            <div class="raise-bar" style="height:14px;border-radius:7px"><div class="raise-fill" style="width:${Math.min(100 - pctRemaining, 100)}%;border-radius:7px"></div></div>
            <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:12px;color:var(--slate)">
              <div style="display:flex;gap:14px;flex-wrap:wrap">
                ${fund.equityRemaining ? `<span>Remaining: <strong style="color:var(--navy)">${fmtMoney(fund.equityRemaining)}</strong></span>` : ''}
                ${fund.currentRaise ? `<span>Current Raise: <strong>${fmtMoney(fund.currentRaise)}</strong></span>` : ''}
              </div>
              <div>Filed Raise: <strong>${fmtMoney(fund.filedRaise)}</strong></div>
            </div>
          ` : '<div style="font-size:13px;color:var(--slate2)">Raise data not available</div>'}
        </div>
        <div>
          <div style="font-size:12px;font-weight:700;color:var(--slate);text-transform:uppercase;letter-spacing:0.06em;margin-bottom:10px">Offering Timeline</div>
          ${pctTimeRemaining != null ? `
            <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px">
              <span style="font-weight:700;color:var(--navy)">${daysRemaining} Days Remaining</span>
              <span style="color:var(--slate2)">${fund.monthsOnMarket ? fund.monthsOnMarket + ' months on market' : pctTimeElapsed + '% elapsed'}</span>
            </div>
            <div class="timeline-bar" style="height:14px;border-radius:7px"><div class="timeline-fill" style="width:${Math.min(pctTimeElapsed, 100)}%;border-radius:7px"></div></div>
            <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:12px;color:var(--slate)">
              <span>Opened: <strong>${fund.openDate ? fund.openDate.toLocaleDateString() : '\u2014'}</strong></span>
              ${fund.monthsOnMarket ? `<span>On Market: <strong>${fund.monthsOnMarket} mo</strong></span>` : ''}
              <span>Est. Close: <strong>${fund.closeDate ? fund.closeDate.toLocaleDateString() : '\u2014'}</strong></span>
            </div>
          ` : `
            <div style="font-size:13px;color:var(--slate2)">
              ${fund.openDate ? 'Opened: <strong>' + fund.openDate.toLocaleDateString() + '</strong>' : ''}
              ${fund.monthsOnMarket ? ' \u00B7 On Market: <strong>' + fund.monthsOnMarket + ' mo</strong>' : ''}
              ${fund.closeDate ? ' \u00B7 Est. Close: <strong>' + fund.closeDate.toLocaleDateString() + '</strong>' : 'Timeline data not available'}
            </div>
          `}
        </div>
      </div>
    </div>`;




  // ‚îÄ‚îÄ Purchase Price & Valuation ‚îÄ‚îÄ
  const valDiscount = (fund.appraisedValue && fund.purchasePrice) ? ((fund.appraisedValue - fund.purchasePrice) / fund.appraisedValue * 100) : null;
  const valSection = `
    <div class="panel detail-section">
      <div class="panel-title">üè∑Ô∏è Purchase Price & Valuation</div>
      ${valDiscount != null ? `
        <div class="val-callout ${valDiscount > 0 ? 'discount' : 'premium'}" style="margin-bottom:14px">
          <div class="val-pct">${valDiscount > 0 ? '-' : '+'}${Math.abs(valDiscount).toFixed(1)}%</div>
          <div>${valDiscount > 0 ? 'Purchased below appraised value ‚Äî built-in equity' : 'Purchased above appraised value ‚Äî loaded pricing'}</div>
        </div>` : ''}
      <div class="metric-grid" style="grid-template-columns:repeat(3,1fr)">
        <div class="metric-tile"><div class="metric-label">Purchase Price</div><div class="metric-value" style="font-size:18px">${fmtMoney(fund.purchasePrice)}</div></div>
        <div class="metric-tile"><div class="metric-label">Appraised Value</div><div class="metric-value" style="font-size:18px">${fmtMoney(fund.appraisedValue)}</div></div>
        <div class="metric-tile"><div class="metric-label">Loaded Price</div><div class="metric-value" style="font-size:18px">${fmtMoney(fund.loadedPrice)}</div></div>
      </div>
      ${fund.pricePerUnit || fund.pricePerSqFt ? `
        <div style="display:flex;gap:16px;margin-top:12px">
          ${fund.pricePerUnit ? `<div style="font-size:12.5px;color:var(--slate)">Price/Unit: <strong>${fmtMoney(fund.pricePerUnit)}</strong></div>` : ''}
          ${fund.pricePerSqFt ? `<div style="font-size:12.5px;color:var(--slate)">Price/SF: <strong>${fmtMoney(fund.pricePerSqFt)}</strong></div>` : ''}
          ${fund.units ? `<div style="font-size:12.5px;color:var(--slate)">Units: <strong>${fund.units}</strong></div>` : ''}
        </div>` : ''}
    </div>`;

  // ‚îÄ‚îÄ Debt & Lease Terms ‚îÄ‚îÄ
  const debtSection = `
    <div class="panel detail-section">
      <div class="panel-title">üè¶ Debt & Lease Terms</div>
      <div class="detail-two-col">
        <div>
          <div class="metric-grid" style="grid-template-columns:1fr 1fr;gap:10px">
            <div class="metric-tile"><div class="metric-label">LTV</div><div class="metric-value" style="font-size:18px">${fmtPct(fund.ltv)}</div>${peerDelta(fund.ltv, p.avgLTV)}</div>
            <div class="metric-tile"><div class="metric-label">DSCR (Base)</div><div class="metric-value" style="font-size:18px">${fund.dscr ? fmtNum(fund.dscr, 2) + 'x' : '‚Äî'}</div></div>
            <div class="metric-tile"><div class="metric-label">DSCR (Stress)</div><div class="metric-value" style="font-size:18px">${fund.dscrStress ? fmtNum(fund.dscrStress, 2) + 'x' : '‚Äî'}</div></div>
            <div class="metric-tile"><div class="metric-label">Hold Period</div><div class="metric-value" style="font-size:18px">${fund.holdPeriod ? fund.holdPeriod + ' yr' : '‚Äî'}</div></div>
          </div>
        </div>
        <div>
          <div class="metric-grid" style="grid-template-columns:1fr 1fr;gap:10px">
            <div class="metric-tile"><div class="metric-label">Avg Lease Term</div><div class="metric-value" style="font-size:18px">${fund.avgLeaseTerm ? fmtNum(fund.avgLeaseTerm, 1) + ' yr' : '‚Äî'}</div>${peerDelta(fund.avgLeaseTerm, p.avgLeaseTerm, ' yr')}</div>
            <div class="metric-tile"><div class="metric-label">Occupancy</div><div class="metric-value" style="font-size:18px">${fmtPct(fund.occupancy)}</div>${peerDelta(fund.occupancy, p.avgOccupancy)}</div>
            <div class="metric-tile" style="grid-column:1/-1"><div class="metric-label">Tenant Credit</div><div class="metric-value" style="font-size:14px">${fund.tenantCredit || '‚Äî'}</div></div>
          </div>
        </div>
      </div>
    </div>`;

  // ‚îÄ‚îÄ Key Drivers ‚îÄ‚îÄ
  const drivers = generateKeyDrivers(fund);
  const keyDriversSection = drivers.length ? `
    <div class="panel detail-section">
      <div class="panel-title">‚ö° Key Drivers</div>
      <div class="kd-grid">${drivers.map(d => `<div class="kd-item ${d.cls}"><span class="kd-icon">${d.icon}</span><div>${d.text}</div></div>`).join('')}</div>
    </div>` : '';

  // ‚îÄ‚îÄ Projected Annual Distributions (Chart.js) ‚îÄ‚îÄ
  const hasIncome = fund.income.some(v => v != null);
  const chartSection = hasIncome ? `
    <div class="panel detail-section">
      <div class="panel-title">üìà Projected Annual Distributions</div>
      <div class="detail-chart-wrap"><canvas id="income-chart"></canvas></div>
    </div>` : '';

  // ‚îÄ‚îÄ 8-Year Projections Table ‚îÄ‚îÄ
  const projYears = fund.income.map((v, i) => v != null ? i : -1).filter(i => i >= 0);
  const maxProj = Math.min(projYears.length, 8);
  const projSection = maxProj > 1 ? `
    <div class="panel detail-section">
      <div class="panel-title">üìä Distribution Projections</div>
      <table class="proj-table">
        <thead><tr><th></th>${projYears.slice(0, maxProj).map((yi, idx) => `<th class="${idx === 0 ? 'highlight' : ''}">Year ${yi + 1}</th>`).join('')}</tr></thead>
        <tbody>
          <tr><td>CoC Return</td>${projYears.slice(0, maxProj).map((yi, idx) => `<td class="${idx === 0 ? 'highlight' : ''}">${fmtPct(fund.income[yi])}</td>`).join('')}</tr>
          ${STATE.client.exchangeAmount ? `<tr><td>Est. Distribution</td>${projYears.slice(0, maxProj).map((yi, idx) => `<td class="${idx === 0 ? 'highlight' : ''}">${fund.income[yi] != null ? fmtMoney(STATE.client.exchangeAmount * fund.income[yi] / 100) : '‚Äî'}</td>`).join('')}</tr>
          <tr><td>Cumulative</td>${projYears.slice(0, maxProj).map((yi, idx) => { let cum = 0; for (let j = 0; j <= idx; j++) { let yj = projYears[j]; if (fund.income[yj] != null) cum += STATE.client.exchangeAmount * fund.income[yj] / 100; } return `<td class="${idx === 0 ? 'highlight' : ''}">${fmtMoney(cum)}</td>`; }).join('')}</tr>` : ''}
        </tbody>
      </table>
    </div>` : '';

  // ‚îÄ‚îÄ Key Takeaways ‚îÄ‚îÄ
  const takeaways = generateTakeaways(fund);
  const takeawaySection = takeaways.length ? `
    <div class="panel detail-section">
      <div class="panel-title">üéØ Key Takeaways</div>
      <div style="display:grid;gap:8px">${takeaways.map(t => `<div style="display:flex;align-items:flex-start;gap:8px;font-size:13px;line-height:1.6;color:var(--navy)"><span style="flex-shrink:0;color:var(--blue)">‚ñ∏</span><span>${t}</span></div>`).join('')}</div>
    </div>` : '';

  // ‚îÄ‚îÄ AI Narrative Sections ‚îÄ‚îÄ
  const narrativeOverview = generateNarrativeOverview(fund);
  const narrativeProperty = generateNarrativeProperty(fund);
  const narrativeFinancial = generateNarrativeFinancial(fund);

  const narrativeSections = `
    <div class="panel detail-section"><div class="panel-title">ü§ñ AI Overview</div><div style="font-size:13px;line-height:1.75;color:var(--navy)">${narrativeOverview}</div></div>
    <div class="detail-two-col detail-section">
      <div class="panel"><div class="panel-title">üè¢ Property & Market</div><div style="font-size:13px;line-height:1.75;color:var(--navy)">${narrativeProperty}</div></div>
      <div class="panel"><div class="panel-title">üí∞ Financial Structure</div><div style="font-size:13px;line-height:1.75;color:var(--navy)">${narrativeFinancial}</div></div>
    </div>`;

  // ‚îÄ‚îÄ Q&A (Phase 2 locked) ‚îÄ‚îÄ
  const qaSection = `
    <div class="panel detail-section" style="opacity:0.5">
      <div class="panel-title">üí¨ Q&A ‚Äî Coming Phase 2</div>
      <div style="text-align:center;padding:20px;font-size:13px;color:var(--slate2)">AI-powered Q&A will be available in the next release. Ask any question about this offering's structure, risks, or suitability.</div>
    </div>`;

  // ‚îÄ‚îÄ Sponsor Track Record ‚îÄ‚îÄ
  const sponsorSection = `
    <div class="panel detail-section">
      <div class="panel-title">üèõÔ∏è Sponsor Track Record ‚Äî ${fund.sponsor}</div>
      <div style="font-size:13px;line-height:1.75;color:var(--navy)">${generateSponsorNarrative(fund)}</div>
    </div>`;

  return navStrip + hero + docRow + actionBar + raiseSection + valSection + debtSection + keyDriversSection + chartSection + projSection + takeawaySection + narrativeSections + qaSection + sponsorSection;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   KEY DRIVERS & TAKEAWAYS GENERATORS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function generateKeyDrivers(fund) {
  const d = [];
  const p = STATE.peer;

  // Income signal
  if (fund.y1coc != null && p.avgY1CoC != null) {
    if (fund.y1coc >= p.avgY1CoC + 1) d.push({ cls: 'positive', icon: 'üìà', text: `Y1 CoC of ${fmtPct(fund.y1coc)} exceeds peer average (${fmtPct(p.avgY1CoC)}) ‚Äî above-market yield` });
    else if (fund.y1coc >= p.avgY1CoC - 0.5) d.push({ cls: 'info', icon: 'üìä', text: `Y1 CoC of ${fmtPct(fund.y1coc)} is in-line with peer average (${fmtPct(p.avgY1CoC)})` });
    else d.push({ cls: 'caution', icon: 'üìâ', text: `Y1 CoC of ${fmtPct(fund.y1coc)} trails peer average (${fmtPct(p.avgY1CoC)}) ‚Äî below-market entry yield` });
  }

  // Leverage
  if (fund.ltv != null) {
    if (fund.ltv > 70) d.push({ cls: 'risk', icon: '‚ö†Ô∏è', text: `LTV of ${fmtPct(fund.ltv)} indicates high leverage ‚Äî reduced debt cushion in a downturn` });
    else if (fund.ltv > 60) d.push({ cls: 'caution', icon: 'üî∂', text: `Moderate leverage at ${fmtPct(fund.ltv)} LTV ‚Äî within typical DST range` });
    else d.push({ cls: 'positive', icon: 'üõ°Ô∏è', text: `Conservative leverage at ${fmtPct(fund.ltv)} LTV ‚Äî strong downside protection` });
  }

  // DSCR
  if (fund.dscr != null) {
    if (fund.dscr < 1.15) d.push({ cls: 'risk', icon: 'üö®', text: `DSCR of ${fmtNum(fund.dscr, 2)}x is thin ‚Äî limited margin to cover debt service` });
    else if (fund.dscr < 1.30) d.push({ cls: 'caution', icon: 'üìê', text: `DSCR of ${fmtNum(fund.dscr, 2)}x provides adequate but not generous debt coverage` });
    else d.push({ cls: 'positive', icon: '‚úÖ', text: `Strong DSCR of ${fmtNum(fund.dscr, 2)}x ‚Äî healthy margin above debt service requirements` });
  }

  // Occupancy
  if (fund.occupancy != null) {
    if (fund.occupancy >= 95) d.push({ cls: 'positive', icon: 'üè¢', text: `${fmtPct(fund.occupancy)} occupied ‚Äî stabilized income stream with minimal vacancy risk` });
    else if (fund.occupancy >= 85) d.push({ cls: 'info', icon: 'üîµ', text: `${fmtPct(fund.occupancy)} occupancy ‚Äî healthy but with some lease-up potential` });
    else d.push({ cls: 'caution', icon: '‚ö°', text: `${fmtPct(fund.occupancy)} occupancy ‚Äî elevated vacancy risk, requires lease-up execution` });
  }

  // Valuation
  if (fund.appraisedValue && fund.purchasePrice) {
    const disc = ((fund.appraisedValue - fund.purchasePrice) / fund.appraisedValue * 100);
    if (disc > 2) d.push({ cls: 'positive', icon: 'üè∑Ô∏è', text: `Purchased at ${disc.toFixed(1)}% below appraised value ‚Äî built-in equity cushion` });
    else if (disc < -2) d.push({ cls: 'caution', icon: 'üí≤', text: `Purchase price exceeds appraisal by ${Math.abs(disc).toFixed(1)}% ‚Äî loaded pricing above market value` });
  }

  // Hold period vs client age
  if (fund.holdPeriod && STATE.client.age) {
    const endAge = STATE.client.age + fund.holdPeriod;
    if (endAge > 85) d.push({ cls: 'caution', icon: '‚è≥', text: `${fund.holdPeriod}-year hold extends to client age ${endAge} ‚Äî consider liquidity needs` });
    else if (endAge > 75) d.push({ cls: 'info', icon: 'üìÖ', text: `${fund.holdPeriod}-year hold period ends at client age ${endAge}` });
    else d.push({ cls: 'positive', icon: '‚è±Ô∏è', text: `${fund.holdPeriod}-year hold is well within client's investment horizon (age ${endAge} at exit)` });
  }

  // Raise momentum
  const pctRaised = fund.pctRaised; const pctRemaining = fund.pctRemaining;
  if (pctRaised != null) {
    if (pctRaised >= 85) d.push({ cls: 'caution', icon: 'üî•', text: `${pctRaised}% raised ‚Äî limited equity remaining, act promptly if interested` });
    else if (pctRaised >= 50) d.push({ cls: 'info', icon: 'üìä', text: `${pctRaised}% raised ‚Äî moderate market adoption, equity still available` });
  }

  return d;
}

function generateTakeaways(fund) {
  const t = [];
  const p = STATE.peer;

  if (fund.y1coc != null && p.avgY1CoC != null) {
    const diff = fund.y1coc - p.avgY1CoC;
    t.push(`Year 1 cash-on-cash of ${fmtPct(fund.y1coc)} is ${Math.abs(diff).toFixed(1)}% ${diff >= 0 ? 'above' : 'below'} the current peer average of ${fmtPct(p.avgY1CoC)} across ${p.count} active DST offerings.`);
  }

  if (fund.ltv != null && p.avgLTV != null) {
    t.push(`Leverage of ${fmtPct(fund.ltv)} LTV ${fund.ltv < p.avgLTV ? 'is below' : 'exceeds'} the peer average of ${fmtPct(p.avgLTV)}, ${fund.ltv <= 55 ? 'reflecting a conservative capital structure.' : fund.ltv <= 65 ? 'within the typical DST range.' : 'indicating an above-average debt load.'}`);
  }

  if (fund.occupancy != null) {
    t.push(`Occupancy of ${fmtPct(fund.occupancy)} ${fund.occupancy >= 95 ? 'suggests a fully stabilized asset with predictable cash flows.' : fund.occupancy >= 85 ? 'is healthy with minor upside from lease-up.' : 'presents elevated vacancy risk but potential upside as leasing improves.'}`);
  }

  if (fund.dscr != null) {
    t.push(`Debt service coverage ratio of ${fmtNum(fund.dscr, 2)}x ${fund.dscr >= 1.3 ? 'provides a strong buffer against income disruption.' : fund.dscr >= 1.15 ? 'offers adequate protection.' : 'is slim ‚Äî income disruptions could stress debt service.'}`);
  }

  if (STATE.client.exchangeAmount && fund.minInvest) {
    const pctOfExchange = (fund.minInvest / STATE.client.exchangeAmount * 100).toFixed(0);
    t.push(`Minimum investment of ${fmtMoney(fund.minInvest)} represents ${pctOfExchange}% of the client's ${fmtMoney(STATE.client.exchangeAmount)} 1031 exchange ‚Äî ${parseInt(pctOfExchange) <= 25 ? 'allowing significant diversification across multiple DSTs.' : parseInt(pctOfExchange) <= 50 ? 'allowing room for one or two additional positions.' : 'consuming a large share of available equity.'}`);
  }

  return t;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AI NARRATIVE GENERATORS (Template-based)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function generateNarrativeOverview(fund) {
  const statusText = fund.status === 'Open' ? 'currently open for investment' : fund.status === 'Closing' ? 'in its final closing phase' : 'coming soon to market';
  return `<strong>${fund.name}</strong> is a ${fund.propType || 'real estate'} Delaware Statutory Trust offering sponsored by <strong>${fund.sponsor}</strong>, ${statusText}. ${fund.location ? `The property is located in <strong>${fund.location}</strong>, ` : ''}${fund.totalRaise ? `with a total equity raise of <strong>${fmtMoney(fund.totalRaise)}</strong>` : ''}${fund.minInvest ? ` and a minimum investment of <strong>${fmtMoney(fund.minInvest)}</strong>` : ''}.
  ${fund.y1coc ? `<br><br>The offering targets a Year 1 cash-on-cash return of <strong>${fmtPct(fund.y1coc)}</strong>` : ''}${fund.holdPeriod ? ` over a projected <strong>${fund.holdPeriod}-year</strong> hold period` : ''}${fund.avgCoc ? `, with an average projected CoC of <strong>${fmtPct(fund.avgCoc)}</strong> across the hold` : ''}.
  ${fund.ltv ? ` The capital structure incorporates <strong>${fmtPct(fund.ltv)}</strong> loan-to-value leverage` : ''}${fund.dscr ? ` with a debt service coverage ratio of <strong>${fmtNum(fund.dscr, 2)}x</strong>` : ''}.`;
}

function generateNarrativeProperty(fund) {
  let text = '';
  if (fund.propType) text += `This is a <strong>${fund.propType}</strong> asset`;
  if (fund.location) text += ` situated in <strong>${fund.location}</strong>`;
  if (fund.units) text += `, comprising <strong>${fund.units} units</strong>`;
  if (fund.sqft) text += `${fund.units ? ' totaling' : ', encompassing'} approximately <strong>${fmtMoney(fund.sqft)} square feet</strong>`;
  text += '. ';
  if (fund.occupancy) text += `The property is currently <strong>${fmtPct(fund.occupancy)} occupied</strong>, ${fund.occupancy >= 95 ? 'reflecting a fully stabilized income stream.' : fund.occupancy >= 85 ? 'indicating healthy tenant demand with minor vacancy.' : 'suggesting lease-up potential that could drive income growth.'}`;
  if (fund.avgLeaseTerm) text += ` Average remaining lease term is <strong>${fmtNum(fund.avgLeaseTerm, 1)} years</strong>, ${fund.avgLeaseTerm >= 7 ? 'providing excellent cash flow visibility.' : fund.avgLeaseTerm >= 4 ? 'offering moderate income predictability.' : 'which introduces near-term rollover risk.'}`;
  if (fund.tenantCredit) text += ` Tenant credit profile: <strong>${fund.tenantCredit}</strong>.`;
  return text || 'Property and market details will be available when data is complete.';
}

function generateNarrativeFinancial(fund) {
  let text = '';
  if (fund.purchasePrice) text += `The property was acquired for <strong>${fmtMoney(fund.purchasePrice)}</strong>`;
  if (fund.appraisedValue) {
    const disc = ((fund.appraisedValue - fund.purchasePrice) / fund.appraisedValue * 100);
    text += ` against an appraised value of <strong>${fmtMoney(fund.appraisedValue)}</strong>, representing a <strong>${disc > 0 ? disc.toFixed(1) + '% discount' : Math.abs(disc).toFixed(1) + '% premium'}</strong> to appraised value`;
  }
  text += '. ';
  if (fund.ltv) text += `Leverage is set at <strong>${fmtPct(fund.ltv)} LTV</strong>`;
  if (fund.dscr) text += `, generating a base DSCR of <strong>${fmtNum(fund.dscr, 2)}x</strong>`;
  if (fund.dscrStress) text += ` (${fmtNum(fund.dscrStress, 2)}x under stress)`;
  text += '. ';
  const hasIncome = fund.income.some(v => v != null);
  if (hasIncome) {
    const yrs = fund.income.filter(v => v != null);
    const minY = Math.min(...yrs);
    const maxY = Math.max(...yrs);
    text += `Projected distributions range from <strong>${fmtPct(minY)}</strong> to <strong>${fmtPct(maxY)}</strong> across the hold period`;
    if (fund.income[0] && fund.income[yrs.length - 1]) {
      const trend = fund.income[yrs.length - 1] - fund.income[0];
      text += `, showing a <strong>${trend > 0 ? 'rising' : trend < 0 ? 'declining' : 'flat'} distribution trajectory</strong>`;
    }
    text += '.';
  }
  return text || 'Financial structure details will be available when data is complete.';
}

function generateSponsorNarrative(fund) {
  let text = `<strong>${fund.sponsor}</strong> is a DST program sponsor active on the Alts Fund Link platform.`;
  if (fund.sponsorAum) text += ` The firm manages approximately <strong>${fund.sponsorAum}</strong> in assets under management.`;
  if (fund.sponsorOfferings) text += ` They have launched <strong>${fund.sponsorOfferings}</strong> offerings`;
  if (fund.sponsorExits) text += ` with <strong>${fund.sponsorExits}</strong> full-cycle exits to date.`;
  else text += '.';
  if (fund.sponsorAvgIrr) text += ` Historical average IRR is <strong>${fmtPct(fund.sponsorAvgIrr)}</strong>`;
  if (fund.sponsorBestIrr) text += ` (best: ${fmtPct(fund.sponsorBestIrr)}`;
  if (fund.sponsorWorstIrr) text += `, worst: ${fmtPct(fund.sponsorWorstIrr)})`;
  else if (fund.sponsorBestIrr) text += ')';
  if (fund.sponsorAvgIrr) text += '.';
  if (fund.sponsorExperience) text += `<br><br><strong>Experience:</strong> ${fund.sponsorExperience}`;
  if (fund.trackRecordUrl) text += '<br><br>Detailed track record documentation is available via the document links above.';
  return text;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INCOME CHART (Chart.js)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderIncomeChart(fund) {
  const ctx = document.getElementById('income-chart');
  if (!ctx) return;

  // Destroy previous chart instance
  if (STATE.incomeChart) { STATE.incomeChart.destroy(); STATE.incomeChart = null; }

  const labels = [];
  const data = [];
  fund.income.forEach((v, i) => {
    if (v != null) { labels.push('Y' + (i + 1)); data.push(v); }
  });
  if (!data.length) return;

  const peerAvg = STATE.peer.avgY1CoC;

  STATE.incomeChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'CoC Return %',
          data: data,
          backgroundColor: data.map((v, i) => i === 0 ? '#1C3A63' : '#3B82F6'),
          borderRadius: 4,
          borderSkipped: false,
          barPercentage: 0.65
        },
        ...(peerAvg ? [{
          label: 'Peer Avg',
          data: data.map(() => peerAvg),
          type: 'line',
          borderColor: '#F59E0B',
          borderDash: [6, 3],
          borderWidth: 2,
          pointRadius: 0,
          fill: false,
          order: 0
        }] : [])
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { intersect: false, mode: 'index' },
      plugins: {
        legend: {
          display: !!peerAvg,
          position: 'top',
          align: 'end',
          labels: { boxWidth: 12, font: { family: "'DM Sans'", size: 11 }, color: '#5C7A99' }
        },
        tooltip: {
          backgroundColor: '#0B1F3B',
          titleFont: { family: "'DM Sans'", size: 12 },
          bodyFont: { family: "'DM Mono'", size: 12 },
          padding: 10,
          cornerRadius: 8,
          callbacks: {
            label: function(ctx) {
              if (ctx.dataset.label === 'Peer Avg') return 'Peer Avg: ' + ctx.raw.toFixed(2) + '%';
              let line = ctx.raw.toFixed(2) + '%';
              if (STATE.client.exchangeAmount) line += ' (' + fmtMoney(STATE.client.exchangeAmount * ctx.raw / 100) + '/yr)';
              return line;
            }
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { callback: v => v + '%', font: { family: "'DM Mono'", size: 11 }, color: '#8FA3BA' },
          grid: { color: '#E8F0F8' },
          border: { display: false }
        },
        x: {
          ticks: { font: { family: "'DM Sans'", size: 11, weight: 600 }, color: '#3A5270' },
          grid: { display: false },
          border: { display: false }
        }
      }
    }
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BASKET VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderBasket() {
  const items = STATE.basket.map(id => STATE.funds.find(f => f.id === id)).filter(Boolean);
  if (!items.length) return `<div class="page-header"><div><div class="page-title">Basket</div><div class="page-subtitle">Your selected offerings for comparison and portfolio building</div></div></div><div class="empty-state"><div class="empty-state-icon">üõí</div><h3>Basket is Empty</h3><p>Add offerings from Browse to compare and build portfolios.</p><button class="btn btn-primary" onclick="navigateTo('browse')">Browse Offerings</button></div>`;

  const totals = {
    avgCoc: items.reduce((s, f) => s + (f.y1coc || 0), 0) / items.filter(f => f.y1coc).length,
    avgLtv: items.reduce((s, f) => s + (f.ltv || 0), 0) / items.filter(f => f.ltv).length,
    totalMin: items.reduce((s, f) => s + (f.minInvest || 0), 0)
  };

  const rows = items.map(f => `
    <tr onclick="navigateTo('offering_detail',${f.id})" style="cursor:pointer">
      <td class="name-cell"><div>${f.name}</div><div style="font-size:11px;color:var(--slate2)">${f.sponsor}</div></td>
      <td class="num-cell">${fmtPct(f.y1coc)}</td>
      <td class="num-cell">${fmtPct(f.ltv)}</td>
      <td class="num-cell">${fmtMoney(f.minInvest)}</td>
      <td>${f.propType}</td>
      <td><button class="btn btn-sm btn-ghost" onclick="event.stopPropagation();toggleBasket(${f.id})" style="color:var(--red)">‚úï</button></td>
    </tr>`).join('');

  return `
    <div class="page-header">
      <div><div class="page-title">Basket</div><div class="page-subtitle">${items.length} offering${items.length > 1 ? 's' : ''} selected</div></div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-secondary" onclick="toast('Portfolio Builder coming Phase 2','error')">üìê Build Portfolio</button>
        <button class="btn btn-ghost" onclick="STATE.basket=[];saveBasket();renderApp();toast('Basket cleared')">Clear All</button>
      </div>
    </div>
    <div class="quick-stats" style="grid-template-columns:repeat(3,1fr);margin-bottom:20px">
      <div class="stat-card"><div class="stat-val">${fmtPct(totals.avgCoc)}</div><div class="stat-label">Avg Y1 CoC</div></div>
      <div class="stat-card"><div class="stat-val">${fmtPct(totals.avgLtv)}</div><div class="stat-label">Avg LTV</div></div>
      <div class="stat-card"><div class="stat-val">${fmtMoney(totals.totalMin)}</div><div class="stat-label">Total Min Invest</div></div>
    </div>
    <div class="table-wrapper"><table class="offering-table"><thead><tr><th>Offering</th><th>Y1 CoC</th><th>LTV</th><th>Min</th><th>Type</th><th></th></tr></thead><tbody>${rows}</tbody></table></div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EVENT HANDLERS & INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function attachViewHandlers() {
  // Render income chart if on detail view
  if (STATE.view === 'offering_detail') {
    const fund = STATE.funds.find(f => f.id === STATE.selectedOfferingId);
    if (fund) {
      requestAnimationFrame(() => renderIncomeChart(fund));
    }
  } else {
    // Destroy chart when leaving detail view
    if (STATE.incomeChart) { STATE.incomeChart.destroy(); STATE.incomeChart = null; }
  }
}

// ‚îÄ‚îÄ Boot ‚îÄ‚îÄ
updateClientBadge();
fetchSheetData();
</script>
</body>
</html>
