<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alts Fund Link ‚Äî Alternative Asset Diligence Intelligence</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700;9..40,800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <script src="shared.js"></script>

  <style>
    /* ‚îÄ‚îÄ‚îÄ Reset & Base ‚îÄ‚îÄ‚îÄ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --navy:    #0B1F3B;
      --navy2:   #1C3A63;
      --navy3:   #2A4D7A;
      --slate:   #3A5270;
      --slate2:  #5C7A99;
      --fog:     #8FA3BA;
      --mist:    #C8D8E8;
      --ice:     #E8F0F8;
      --white:   #FFFFFF;
      --surface: #F4F7FB;
      --surface2:#EEF3FA;
      --green:   #1A7A4A;
      --green-lt:#E8F7EF;
      --amber:   #B45309;
      --amber-lt:#FEF3C7;
      --red:     #991B1B;
      --red-lt:  #FEE2E2;
      --blue:    #1D4ED8;
      --blue-lt: #EFF6FF;
      --radius:  8px;
      --radius-lg: 14px;
      --shadow-sm: 0 1px 3px rgba(11,31,59,0.08), 0 1px 2px rgba(11,31,59,0.05);
      --shadow:    0 4px 12px rgba(11,31,59,0.10);
      --shadow-lg: 0 12px 32px rgba(11,31,59,0.14);
      --font: 'DM Sans', sans-serif;
      --mono: 'DM Mono', monospace;
      --transition: 0.18s cubic-bezier(0.4,0,0.2,1);
      --header-h: 60px;
      --sidebar-w: 218px;
    }

    html, body {
      height: 100%; overflow: hidden;
      font-family: var(--font); font-size: 14px;
      color: var(--slate); background: var(--surface);
      -webkit-font-smoothing: antialiased;
    }

    /* ‚îÄ‚îÄ‚îÄ App Layout ‚îÄ‚îÄ‚îÄ */
    #afl-app {
      display: flex; flex-direction: column;
      height: 100vh; overflow: hidden;
    }

    /* ‚îÄ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ */
    #afl-header {
      height: var(--header-h); min-height: var(--header-h);
      background: var(--navy);
      display: flex; align-items: center;
      padding: 0 20px; gap: 0;
      position: relative; z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
    }

    /* Logo */
    .header-logo {
      display: flex; align-items: center; gap: 10px;
      text-decoration: none; flex-shrink: 0;
    }
    .header-logo__mark {
      width: 34px; height: 34px;
      background: var(--blue);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 15px; font-weight: 800; color: var(--white);
      letter-spacing: -0.5px; flex-shrink: 0;
    }
    .header-logo__text {
      display: flex; flex-direction: column; line-height: 1.1;
    }
    .header-logo__name {
      font-size: 13px; font-weight: 700; color: var(--white);
      letter-spacing: 0.02em;
    }
    .header-logo__tagline {
      font-size: 9.5px; font-weight: 400;
      color: rgba(255,255,255,0.5);
      letter-spacing: 0.03em; text-transform: uppercase;
    }

    /* View mode tabs */
    .header-view-tabs {
      display: flex; align-items: center; gap: 4px;
      margin: 0 auto; /* center */
    }
    .header-view-tab {
      padding: 6px 16px; border-radius: 6px;
      font-size: 12.5px; font-weight: 500;
      color: rgba(255,255,255,0.6);
      cursor: pointer; border: none; background: transparent;
      transition: var(--transition);
      letter-spacing: 0.01em;
    }
    .header-view-tab:hover { color: rgba(255,255,255,0.9); background: rgba(255,255,255,0.07); }
    .header-view-tab--active {
      background: rgba(255,255,255,0.15) !important;
      color: var(--white) !important;
    }

    /* Header right zone */
    .header-right {
      display: flex; align-items: center; gap: 12px; flex-shrink: 0;
      margin-left: 20px;
    }

    .header-live-pill {
      display: flex; align-items: center; gap: 5px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 20px; padding: 3px 10px 3px 8px;
      font-size: 11.5px; font-weight: 500; color: rgba(255,255,255,0.8);
    }
    .header-live-pill__dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: #34d399;
      box-shadow: 0 0 0 2px rgba(52,211,153,0.3);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 2px rgba(52,211,153,0.3); }
      50%       { box-shadow: 0 0 0 5px rgba(52,211,153,0.0); }
    }

    .header-client-badge {
      display: flex; align-items: center; gap: 6px;
      background: rgba(29,78,216,0.25);
      border: 1px solid rgba(29,78,216,0.4);
      border-radius: 20px; padding: 4px 12px 4px 8px;
      font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.9);
      cursor: pointer; transition: var(--transition);
    }
    .header-client-badge:hover { background: rgba(29,78,216,0.4); }
    .header-client-badge__icon { font-size: 13px; opacity: 0.7; }
    .header-client-badge--empty { opacity: 0.5; }

    /* ‚îÄ‚îÄ‚îÄ Body: sidebar + content ‚îÄ‚îÄ‚îÄ */
    #afl-body {
      display: flex; flex: 1; overflow: hidden;
    }

    /* ‚îÄ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ */
    #afl-sidebar {
      width: var(--sidebar-w); min-width: var(--sidebar-w);
      background: var(--white);
      border-right: 1px solid var(--mist);
      display: flex; flex-direction: column;
      overflow-y: auto; overflow-x: hidden;
      height: 100%;
    }

    .sidebar-section-label {
      font-size: 10px; font-weight: 700; letter-spacing: 0.08em;
      text-transform: uppercase; color: var(--fog);
      padding: 20px 16px 6px;
    }

    .sidebar-nav {
      list-style: none; padding: 4px 10px 0;
    }
    .sidebar-nav__item {
      display: flex; align-items: center; gap: 9px;
      padding: 8px 10px; border-radius: var(--radius);
      cursor: pointer; color: var(--slate);
      font-size: 13.5px; font-weight: 500;
      transition: var(--transition);
      user-select: none; position: relative;
      white-space: nowrap;
    }
    .sidebar-nav__item:hover { background: var(--surface); color: var(--navy); }
    .sidebar-nav__item--active {
      background: var(--blue-lt) !important;
      color: var(--blue) !important;
    }
    .sidebar-nav__item--active .sidebar-nav__icon { color: var(--blue); }

    .sidebar-nav__icon { font-size: 15px; flex-shrink: 0; width: 18px; text-align: center; }
    .sidebar-nav__label { flex: 1; }

    .sidebar-nav__badge {
      background: var(--navy2); color: var(--white);
      font-size: 10.5px; font-weight: 700;
      padding: 1px 6px; border-radius: 10px;
      min-width: 20px; text-align: center;
    }
    .sidebar-nav__badge--blue { background: var(--blue); }
    .sidebar-nav__badge--green { background: var(--green); }

    .sidebar-divider {
      height: 1px; background: var(--mist);
      margin: 12px 16px;
    }

    .sidebar-bottom {
      margin-top: auto;
      padding: 12px 10px 16px;
      border-top: 1px solid var(--mist);
    }
    .sidebar-version {
      font-size: 10.5px; color: var(--fog);
      padding: 4px 10px;
    }

    /* ‚îÄ‚îÄ‚îÄ App Content ‚îÄ‚îÄ‚îÄ */
    #app-content {
      flex: 1; overflow-y: auto; overflow-x: hidden;
      background: var(--surface);
      height: 100%;
    }

    /* ‚îÄ‚îÄ‚îÄ Module Loading State ‚îÄ‚îÄ‚îÄ */
    .module-loading {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      height: 100%; gap: 16px;
      color: var(--slate2); font-size: 14px;
    }
    .loading-spinner {
      width: 36px; height: 36px;
      border: 3px solid var(--mist);
      border-top-color: var(--blue);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .module-error {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      height: 100%; gap: 12px; text-align: center;
      padding: 40px;
    }
    .module-error__icon { font-size: 40px; }
    .module-error h3 { font-size: 17px; font-weight: 600; color: var(--navy); }
    .module-error p  { color: var(--slate2); max-width: 400px; line-height: 1.5; }
    .module-error button {
      margin-top: 8px; padding: 8px 20px;
      background: var(--blue); color: var(--white);
      border: none; border-radius: var(--radius);
      font-family: var(--font); font-size: 13px; font-weight: 600;
      cursor: pointer; transition: var(--transition);
    }
    .module-error button:hover { opacity: 0.88; }

    /* ‚îÄ‚îÄ‚îÄ Shared component styles (used by modules) ‚îÄ‚îÄ‚îÄ */

    /* Badges */
    .badge {
      display: inline-flex; align-items: center;
      font-size: 11px; font-weight: 600; letter-spacing: 0.02em;
      padding: 2px 8px; border-radius: 20px;
    }
    .badge--green { background: var(--green-lt); color: var(--green); }
    .badge--amber { background: var(--amber-lt); color: var(--amber); }
    .badge--red   { background: var(--red-lt);   color: var(--red);   }
    .badge--blue  { background: var(--blue-lt);  color: var(--blue);  }
    .badge--fog   { background: var(--ice);       color: var(--fog);   }

    /* Suitability chip */
    .suit-chip {
      display: inline-flex; align-items: center;
      font-size: 11px; font-weight: 600;
      padding: 2px 9px; border-radius: 20px;
    }
    .suit-chip--green { background: var(--green-lt); color: var(--green); }
    .suit-chip--blue  { background: var(--blue-lt);  color: var(--blue);  }
    .suit-chip--amber { background: var(--amber-lt); color: var(--amber); }
    .suit-chip--red   { background: var(--red-lt);   color: var(--red);   }

    /* Buttons */
    .btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 18px; border-radius: var(--radius);
      font-family: var(--font); font-size: 13px; font-weight: 600;
      cursor: pointer; border: none; transition: var(--transition);
      text-decoration: none; white-space: nowrap;
    }
    .btn--primary { background: var(--blue); color: var(--white); }
    .btn--primary:hover { background: #1a45c2; }
    .btn--secondary { background: var(--surface2); color: var(--slate); border: 1px solid var(--mist); }
    .btn--secondary:hover { background: var(--ice); border-color: var(--fog); }
    .btn--ghost { background: transparent; color: var(--slate2); border: 1px solid var(--mist); }
    .btn--ghost:hover { background: var(--surface2); color: var(--slate); }
    .btn--sm { padding: 5px 12px; font-size: 12px; }
    .btn--danger { background: var(--red); color: var(--white); }
    .btn--danger:hover { background: #7f1d1d; }

    /* Cards */
    .card {
      background: var(--white); border: 1px solid var(--mist);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
    }

    /* KPI stat boxes */
    .kpi-box {
      display: flex; flex-direction: column;
      gap: 2px;
    }
    .kpi-box__label {
      font-size: 10.5px; font-weight: 600; letter-spacing: 0.04em;
      text-transform: uppercase; color: var(--fog);
    }
    .kpi-box__value {
      font-size: 16px; font-weight: 700; color: var(--navy);
      font-family: var(--mono);
    }
    .kpi-box__sub {
      font-size: 11px; color: var(--slate2);
    }

    /* Toast / notifications */
    #afl-toast-container {
      position: fixed; bottom: 24px; right: 24px;
      display: flex; flex-direction: column; gap: 8px;
      z-index: 9999; pointer-events: none;
    }
    .afl-toast {
      padding: 10px 16px; border-radius: var(--radius);
      font-size: 13px; font-weight: 500;
      box-shadow: var(--shadow-lg); pointer-events: auto;
      animation: toastIn 0.2s ease; max-width: 320px;
    }
    .afl-toast--success { background: var(--navy); color: var(--white); }
    .afl-toast--error   { background: var(--red);  color: var(--white); }
    .afl-toast--info    { background: var(--blue); color: var(--white); }
    @keyframes toastIn { from { opacity:0; transform: translateY(8px); } to { opacity:1; transform: translateY(0); } }

    /* Dashboard welcome (shown before first module loads) */
    .welcome-screen {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      height: 100%; gap: 20px; text-align: center;
      padding: 40px;
    }
    .welcome-screen__logo {
      font-size: 48px; font-weight: 800; color: var(--navy);
      letter-spacing: -2px;
    }
    .welcome-screen__title {
      font-size: 24px; font-weight: 700; color: var(--navy);
    }
    .welcome-screen__sub {
      font-size: 15px; color: var(--slate2); max-width: 420px; line-height: 1.6;
    }
    .welcome-screen__actions {
      display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;
      margin-top: 8px;
    }
  </style>
</head>
<body>

<div id="afl-app">

  <!-- ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê -->
  <header id="afl-header">

    <!-- Logo -->
    <a href="#" class="header-logo" onclick="AFL.loadModule('browse'); return false;">
      <div class="header-logo__mark">AFL</div>
      <div class="header-logo__text">
        <span class="header-logo__name">Alts Fund Link</span>
        <span class="header-logo__tagline">Alternative Asset Diligence Intelligence</span>
      </div>
    </a>

    <!-- View mode tabs (centered) -->
    <nav class="header-view-tabs">
      <button class="header-view-tab header-view-tab--active" data-view="advisor"    onclick="setViewMode(this, 'advisor')">Advisor View</button>
      <button class="header-view-tab"                          data-view="client"    onclick="setViewMode(this, 'client')">Client Report</button>
      <button class="header-view-tab"                          data-view="compliance" onclick="setViewMode(this, 'compliance')">Compliance</button>
    </nav>

    <!-- Right zone -->
    <div class="header-right">
      <div class="header-live-pill" id="live-pill">
        <div class="header-live-pill__dot"></div>
        <span id="live-count">‚Äî offerings live</span>
      </div>
      <div class="header-client-badge header-client-badge--empty" id="client-badge" onclick="AFL.loadModule('client')">
        <span class="header-client-badge__icon">üë§</span>
        <span id="client-badge-name">Set Client</span>
      </div>
    </div>

  </header>

  <!-- ‚ïê‚ïê‚ïê BODY ‚ïê‚ïê‚ïê -->
  <div id="afl-body">

    <!-- ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ -->
    <aside id="afl-sidebar">

      <p class="sidebar-section-label">Platform</p>
      <ul class="sidebar-nav">
        <li class="sidebar-nav__item" data-module="browse" onclick="nav('browse')">
          <span class="sidebar-nav__icon">üè¢</span>
          <span class="sidebar-nav__label">Browse</span>
          <span class="sidebar-nav__badge sidebar-nav__badge--green" id="sb-count">‚Äî</span>
        </li>
        <li class="sidebar-nav__item" data-module="builder" onclick="nav('builder')">
          <span class="sidebar-nav__icon">üìä</span>
          <span class="sidebar-nav__label">Portfolio Builder</span>
        </li>
        <li class="sidebar-nav__item" data-module="model" onclick="nav('model')">
          <span class="sidebar-nav__icon">üî¢</span>
          <span class="sidebar-nav__label">1031 Model</span>
        </li>
      </ul>

      <p class="sidebar-section-label" style="margin-top:8px;">Basket</p>
      <ul class="sidebar-nav">
        <li class="sidebar-nav__item" data-module="offering" id="sb-basket-item" onclick="navBasket()">
          <span class="sidebar-nav__icon">üóÇÔ∏è</span>
          <span class="sidebar-nav__label">My Basket</span>
          <span class="sidebar-nav__badge sidebar-nav__badge--blue" id="sb-basket-count" style="display:none">0</span>
        </li>
      </ul>

      <div class="sidebar-divider"></div>

      <p class="sidebar-section-label">Profile</p>
      <ul class="sidebar-nav">
        <li class="sidebar-nav__item" data-module="client" onclick="nav('client')">
          <span class="sidebar-nav__icon">üë§</span>
          <span class="sidebar-nav__label">Client Profile</span>
        </li>
        <li class="sidebar-nav__item" data-module="sponsor" onclick="nav('sponsor')">
          <span class="sidebar-nav__icon">üè¶</span>
          <span class="sidebar-nav__label">Sponsors</span>
        </li>
      </ul>

      <div class="sidebar-bottom">
        <div class="sidebar-version">AFL Platform v1.0</div>
      </div>

    </aside>

    <!-- ‚îÄ‚îÄ‚îÄ MODULE CONTENT ‚îÄ‚îÄ‚îÄ -->
    <main id="app-content">
      <!-- Welcome screen shown on first load -->
      <div class="welcome-screen">
        <div class="welcome-screen__logo">AFL</div>
        <h1 class="welcome-screen__title">Alts Fund Link</h1>
        <p class="welcome-screen__sub">
          Alternative Asset Diligence Intelligence ‚Äî browse, compare, and model
          DST and alternative investment offerings for your clients.
        </p>
        <div class="welcome-screen__actions">
          <button class="btn btn--primary" onclick="nav('browse')">Browse Offerings</button>
          <button class="btn btn--secondary" onclick="nav('client')">Set Client Profile</button>
        </div>
      </div>
    </main>

  </div><!-- /#afl-body -->

</div><!-- /#afl-app -->

<!-- Toast container -->
<div id="afl-toast-container"></div>

<script>
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Shell bootstrap
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  // Navigation helper
  function nav(module) {
    AFL.loadModule(module);
  }

  function navBasket() {
    const ids = AFL.state.basket;
    if (ids.length === 0) {
      showToast('Your basket is empty ‚Äî browse offerings to add some.', 'info');
      return;
    }
    AFL.loadModule('offering', { ids });
  }

  // View mode switcher
  function setViewMode(btn, mode) {
    AFL.state.viewMode = mode;
    document.querySelectorAll('.header-view-tab').forEach(t => t.classList.remove('header-view-tab--active'));
    btn.classList.add('header-view-tab--active');
    // Notify current module
    window.dispatchEvent(new CustomEvent('afl:viewmodechange', { detail: { mode } }));
  }

  // ‚îÄ‚îÄ‚îÄ Header update handler ‚îÄ‚îÄ‚îÄ
  function refreshHeader() {
    const client = AFL.state.client;
    const basketCount = AFL.state.basket.length;

    // Client badge
    const badge     = document.getElementById('client-badge');
    const badgeName = document.getElementById('client-badge-name');
    if (client && client.name) {
      badge.classList.remove('header-client-badge--empty');
      badgeName.textContent = client.name;
    } else {
      badge.classList.add('header-client-badge--empty');
      badgeName.textContent = 'Set Client';
    }

    // Basket sidebar badge
    const sb = document.getElementById('sb-basket-count');
    if (basketCount > 0) {
      sb.textContent = basketCount;
      sb.style.display = '';
    } else {
      sb.style.display = 'none';
    }
  }

  window.addEventListener('afl:headerupdate', (e) => refreshHeader());
  window.addEventListener('afl:basketchange', (e) => refreshHeader());
  window.addEventListener('afl:navigate', (e) => {
    AFL.loadModule(e.detail.module, e.detail.params);
  });

  // ‚îÄ‚îÄ‚îÄ Toast system ‚îÄ‚îÄ‚îÄ
  function showToast(msg, type = 'success', duration = 3200) {
    const container = document.getElementById('afl-toast-container');
    const el = document.createElement('div');
    el.className = `afl-toast afl-toast--${type}`;
    el.textContent = msg;
    container.appendChild(el);
    setTimeout(() => {
      el.style.transition = 'opacity 0.3s';
      el.style.opacity = '0';
      setTimeout(() => el.remove(), 320);
    }, duration);
  }
  // Expose globally
  window.showToast = showToast;

  // ‚îÄ‚îÄ‚îÄ On page load ‚îÄ‚îÄ‚îÄ
  (async function init() {
    // Restore last view mode
    const savedMode = localStorage.getItem('afl_viewmode') || 'advisor';
    AFL.state.viewMode = savedMode;
    const modeBtn = document.querySelector(`[data-view="${savedMode}"]`);
    if (modeBtn) {
      document.querySelectorAll('.header-view-tab').forEach(t => t.classList.remove('header-view-tab--active'));
      modeBtn.classList.add('header-view-tab--active');
    }

    // Kick off fund loading in background (don't await ‚Äî let module init handle it)
    AFL.loadFunds().then(funds => {
      // Update live count in header
      const liveCount = funds.filter(f => f.status !== 'Closed').length;
      document.getElementById('live-count').textContent = `${funds.length} offerings live`;
      document.getElementById('sb-count').textContent = funds.length;
    }).catch(err => console.warn('[AFL] Background fund load failed:', err));

    // Sync header from saved state
    refreshHeader();

    // Auto-navigate to last active module (or browse)
    const lastNav = AFL.state.nav || 'browse';
    AFL.loadModule(lastNav);
  })();

  // Persist view mode on change
  window.addEventListener('afl:viewmodechange', (e) => {
    localStorage.setItem('afl_viewmode', e.detail.mode);
  });
</script>
</body>
</html>
